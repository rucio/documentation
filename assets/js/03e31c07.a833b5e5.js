"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[22143],{28453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>a});var t=r(96540);const s={},i=t.createContext(s);function d(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(i.Provider,{value:n},e.children)}},53016:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"started/main_components/daemons","title":"Rucio Daemons","description":"Rucio relies on several daemons (processes) to perform different logic.","source":"@site/../docs/started/main_components/daemons.md","sourceDirName":"started/main_components","slug":"/started/main_components/daemons","permalink":"/documentation/started/main_components/daemons","draft":false,"unlisted":false,"editUrl":"https://github.com/rucio/documentation/tree/main/docs/../docs/started/main_components/daemons.md","tags":[],"version":"current","lastUpdatedBy":"rdimaio","lastUpdatedAt":1762446178000,"frontMatter":{"id":"daemons","title":"Rucio Daemons","sidebar_label":"Rucio Daemons"},"sidebar":"docs","previous":{"title":"Main Components","permalink":"/documentation/started/main_components/"},"next":{"title":"Additional Layers and Resources","permalink":"/documentation/started/additional_layers_and_resources"}}');var s=r(74848),i=r(28453);const d={id:"daemons",title:"Rucio Daemons",sidebar_label:"Rucio Daemons"},a=void 0,c={},l=[{value:"Daemons",id:"daemons",level:2},{value:"FAQ",id:"faq",level:2},{value:"Conveyor daemons",id:"conveyor-daemons",level:3},{value:"What happens when a rule is stuck?",id:"what-happens-when-a-rule-is-stuck",level:3},{value:"What happens when new data is added to an existing dataset that already has replicas?",id:"what-happens-when-new-data-is-added-to-an-existing-dataset-that-already-has-replicas",level:3},{value:"What is the purpose of the minos daemons?",id:"what-is-the-purpose-of-the-minos-daemons",level:3},{value:"What is the relationship between auditor, rucio-dumper and dark-reaper?",id:"what-is-the-relationship-between-auditor-rucio-dumper-and-dark-reaper",level:3},{value:"How is data deleted?",id:"how-is-data-deleted",level:3},{value:"How is a replica declared bad?",id:"how-is-a-replica-declared-bad",level:3},{value:"What is the purpose of undertaker?",id:"what-is-the-purpose-of-undertaker",level:3},{value:"Daemon arguments",id:"daemon-arguments",level:2},{value:"Batched Daemons",id:"batched-daemons",level:3},{value:"Threaded Daemons",id:"threaded-daemons",level:3},{value:"Multi-VO Daemons",id:"multi-vo-daemons",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Rucio relies on several daemons (processes) to perform different logic.\nMost of the daemons connect to the DB to read some data, perform some computation,\nand then write some data back into the DB."}),"\n",(0,s.jsx)(n.p,{children:"Usually one daemon will create some work for another daemon and vice-versa.\nIn Rucio realm, daemons communicate to others by the DB.\nThe following table represents a high level view of the responsibility of each of the daemons and basic functionality."}),"\n",(0,s.jsx)(n.h2,{id:"daemons",children:"Daemons"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Name"}),(0,s.jsx)(n.th,{children:"Domain"}),(0,s.jsx)(n.th,{children:"Purpose"}),(0,s.jsx)(n.th,{children:"Batched?"}),(0,s.jsx)(n.th,{children:"Threaded?"}),(0,s.jsx)(n.th,{children:"Multi-VO?"}),(0,s.jsx)(n.th,{children:"Details"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-abacus-account"}),(0,s.jsx)(n.td,{children:"Accounting"}),(0,s.jsx)(n.td,{children:"Account usage"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-abacus-account",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-abacus-collection-replica"}),(0,s.jsx)(n.td,{children:"Accounting"}),(0,s.jsx)(n.td,{children:"Updates collection replicas"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-abacus-collection-replica",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-abacus-rse"}),(0,s.jsx)(n.td,{children:"Accounting"}),(0,s.jsx)(n.td,{children:"Updates RSE counters"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-abacus-rse",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-atropos"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"End the life of the rules according to the Lifetime Model"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-atropos",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-auditor"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Find inconsistencies on storage, for example, dark data discovery"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-auditor",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-automatix"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Used for testing: injects random data in RSEs to check liveness"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-automatix",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-bb8"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Rebalance data across RSEs"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-bb8",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-cache-client"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Populates information of replicas on volatile storage"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-cache-client",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-cache-consumer"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Adds and deletes cache replicas to the Rucio catalog"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-cache-consumer",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-finisher"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Updates Rucio internal state after the file transfer has finished"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-finisher",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-poller"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Polls updates from the transfer tool to check the transfer state"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-poller",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-preparer"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Prepares data transfers"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-preparer",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-receiver"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Sister of poller, instead of polling for updates, it reads transfer tools notifications to check transfer state"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-receiver",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-stager"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Issues staging (bring online) requests to tape RSEs"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-stager",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-submitter"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Submit transfer requests to the transfer tool (prepares the transfer as well if the conveyor-preparer is not enabled)"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-submitter",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-conveyor-throttler"}),(0,s.jsx)(n.td,{children:"Transfer"}),(0,s.jsx)(n.td,{children:"Queues transfer requests inside Rucio, applying limits, ex: only one transfer at a time, etc ..."}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-conveyor-throttler",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-dark-reaper"}),(0,s.jsx)(n.td,{children:"Deletion"}),(0,s.jsx)(n.td,{children:"Deletes quarantined replicas"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-dark-reaper",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-dumper"}),(0,s.jsx)(n.td,{children:"Consistency"}),(0,s.jsx)(n.td,{children:"Dumps file lists. The rucio-auditor consumes these dumps to discover dark data"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-dumper",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-follower"}),(0,s.jsx)(n.td,{children:"Telemetry"}),(0,s.jsx)(n.td,{children:"Aggregates events affecting DIDs"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-follower",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-hermes"}),(0,s.jsx)(n.td,{children:"Telemetry"}),(0,s.jsx)(n.td,{children:"Sends Rucio messages to external services (InfluxDB, OpenSearch, ActiveMQ, ...)"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-hermes",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-judge-cleaner"}),(0,s.jsx)(n.td,{children:"Rule"}),(0,s.jsx)(n.td,{children:"Cleans expired replication rules"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-judge-cleaner",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-judge-evaluator"}),(0,s.jsx)(n.td,{children:"Rule"}),(0,s.jsx)(n.td,{children:"Creates and evaluates replication rules based on their state (OK/REPL/STUCK)"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-judge-evaluator",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-judge-injector"}),(0,s.jsx)(n.td,{children:"Rule"}),(0,s.jsx)(n.td,{children:"Asynchronously injects replication rules"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-judge-injector",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-judge-repairer"}),(0,s.jsx)(n.td,{children:"Rule"}),(0,s.jsx)(n.td,{children:"Repairs stuck replication rules (STATE=STUCK)"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-judge-repairer",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-kronos"}),(0,s.jsx)(n.td,{children:"Telemetry"}),(0,s.jsx)(n.td,{children:"Consumes Rucio tracing messages, updates access time of replicas and access count of DIDs"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-kronos",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-minos"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Reads list of physical file names (PFNs) declared bad and classifies them in: temporary unavailable  and permanently unavailable (to be recovered by the necromancer daemon)"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-minos",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-minos-temporary-expiration"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Moves back TEMPORARY_UNAVAILABLE replicas into AVAILABLE state"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-minos-temporary-expiration",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-necromancer"}),(0,s.jsx)(n.td,{children:"Deletion"}),(0,s.jsx)(n.td,{children:"Works on permanently unavailable replicas, it tries to recover the data from other valid replicas if any, else declares the replica as lost"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-necromancer",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-oauth-manager"}),(0,s.jsx)(n.td,{children:"Auth/Authz"}),(0,s.jsx)(n.td,{children:"Deletes expired access tokens (in case there is a valid refresh token, expired access tokens will be kept until refresh_token expires as well.) and deletion of expired OAuth session parameters"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-oauth-manager",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-reaper"}),(0,s.jsx)(n.td,{children:"Deletion"}),(0,s.jsx)(n.td,{children:"Deletes replicas that don't have locks anymore, i.e. they have a tombstone set"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-reaper",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-replica-recoverer"}),(0,s.jsx)(n.td,{children:"Replica"}),(0,s.jsx)(n.td,{children:"Declares suspicious replicas as bad if they are found available on other RSEs, so necromancer will work on them"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-replica-recoverer",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-rse-decommissioner"}),(0,s.jsx)(n.td,{children:"Deletion"}),(0,s.jsx)(n.td,{children:"Decommissions an RSE. The actions to perform are specified in decommissioning profiles (delete all data, move replicas, etc ...)"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-rse-decommissioner",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-storage-consistency-actions"}),(0,s.jsx)(n.td,{children:"Consistency"}),(0,s.jsx)(n.td,{children:"Applies corrective actions as a result of a consistency check on an RSE"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-storage-consistency-actions",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-transmogrifier"}),(0,s.jsx)(n.td,{children:"Rule"}),(0,s.jsx)(n.td,{children:"Creates replication rules for DIDs matching a subscription"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-transmogrifier",children:"Details"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"rucio-undertaker"}),(0,s.jsx)(n.td,{children:"Deletion"}),(0,s.jsx)(n.td,{children:"Manages expired DIDs, deleting them (does not delete replicas)"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u2705"}),(0,s.jsx)(n.td,{children:"\u274c"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.a,{href:"/documentation/bin/rucio-undertaker",children:"Details"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,s.jsx)(n.h3,{id:"conveyor-daemons",children:"Conveyor daemons"}),"\n",(0,s.jsx)(n.p,{children:"It is important to know the following:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The throttler daemon will need the preparer to work."}),"\n",(0,s.jsx)(n.li,{children:"The preparer is a daemon that optimizes transfer requests, while recommended to install, it's not mandatory."}),"\n",(0,s.jsx)(n.li,{children:"The submitter is the only daemon needed to submit transfers and can do a subset of what the preparer can do."}),"\n",(0,s.jsx)(n.li,{children:"To update the state of requests, the conveyor poller (polls for changes) or conveyor receiver (listens for changes)  are needed to understand the new state."}),"\n",(0,s.jsx)(n.li,{children:"The finisher analyzes this new state and updates the state."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"what-happens-when-a-rule-is-stuck",children:"What happens when a rule is stuck?"}),"\n",(0,s.jsx)(n.p,{children:"The judge repairer will analyze why the transfer is stuck and try to unstuck it, eventually resubmitting the request."}),"\n",(0,s.jsx)(n.h3,{id:"what-happens-when-new-data-is-added-to-an-existing-dataset-that-already-has-replicas",children:"What happens when new data is added to an existing dataset that already has replicas?"}),"\n",(0,s.jsx)(n.p,{children:"The judge evaluator will keep track of new data added to datasets that are already replicated to trigger the necessary transfer requests to ensure all new data is copied to the RSEs."}),"\n",(0,s.jsx)(n.h3,{id:"what-is-the-purpose-of-the-minos-daemons",children:"What is the purpose of the minos daemons?"}),"\n",(0,s.jsx)(n.p,{children:"An human operator can declare some datasets as temporarily unavailable due to maintenance, outages, etc ...The operator will set an expiration time on the temporary unavailable status. When the expiration time is reached, the minos-temporary-expiration will put the replicas back in available state."}),"\n",(0,s.jsx)(n.h3,{id:"what-is-the-relationship-between-auditor-rucio-dumper-and-dark-reaper",children:"What is the relationship between auditor, rucio-dumper and dark-reaper?"}),"\n",(0,s.jsx)(n.p,{children:"The dumper will create a dump of all the files in an RSE that will be passed to the auditor. The auditor will check for inconsistencies and mark missing data as dark data (quarantined replicas).\nDark reaper is the one deleting this dark data to free up space from the quarantined replicas table."}),"\n",(0,s.jsx)(n.h3,{id:"how-is-data-deleted",children:"How is data deleted?"}),"\n",(0,s.jsx)(n.p,{children:"When replicas are healthy, the judge-cleaner will set a tombstone on replicas where the lifetime has expired. These replicas are taken by the reaper and they are deleted.\nSometimes, replicas can become unhealthy. A dump is created by the dumper daemon. The auditor checks these dumps and declares replicas as suspicious."}),"\n",(0,s.jsx)(n.h3,{id:"how-is-a-replica-declared-bad",children:"How is a replica declared bad?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"An operator can declare a replica as bad issuing rucio cli commands."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"rucio-admin replicas declare-bad [-h] --reason REASON [--inputfile [INPUTFILE]] [--allow-collection] [--lfns [LFNS]] [--scope [SCOPE]] [--rse [RSE]] [listbadfiles ...]\n"})}),"\n",(0,s.jsx)(n.p,{children:"These bad replicas are taken by the necromancer daemon and then deleted if they cannot be recovered from other RSEs."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["the suspicious-replica-recoverer is a daemon that will analyze different counters (transfer errors, download errors, etc ...) to mark replicas as being suspicious to have an issue. After hitting\na certain limit (configurable by ",(0,s.jsx)(n.code,{children:"--nattempts"})," flag), the replica is marked as bad and eventually consumed by the necromancer."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"what-is-the-purpose-of-undertaker",children:"What is the purpose of undertaker?"}),"\n",(0,s.jsx)(n.p,{children:'A dataset is "never" deleted, however, when the dataset is known to be bad, there is no point having it in the catalog. The undertaker daemon takes care to remove these datasets.\nAn operator will set an expiration date in the past of the DIDs and this daemon will delete the dataset from the DB. If there were any replicas attached, the replicas will be deleted as well.'}),"\n",(0,s.jsx)(n.h2,{id:"daemon-arguments",children:"Daemon arguments"}),"\n",(0,s.jsxs)(n.p,{children:["A full description for each daemon's arguments can be found by running ",(0,s.jsx)(n.code,{children:"rucio-{daemon} --help"})," or viewing the ",(0,s.jsx)(n.code,{children:"Details"})," in the daemon description table above.\nListed below are common definitions between different daemons."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"run-once"})," - Only run one iteration of the daemon. If executed with this argument the daemon will run once and close."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"sleep-time"})," - How long a daemon will sleep between iterations, mutually exclusive with ",(0,s.jsx)(n.code,{children:"run-once"}),". Units of seconds."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"threads"}),", ",(0,s.jsx)(n.strong,{children:"total-workers"}),", ",(0,s.jsx)(n.strong,{children:"threads-per-process"}),", ",(0,s.jsx)(n.strong,{children:"nprocs"})," - ",(0,s.jsx)(n.em,{children:"[Present in threaded daemons]"})," Run in threaded mode."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"bulk"}),", ",(0,s.jsx)(n.strong,{children:"chunk-size"}),", ",(0,s.jsx)(n.strong,{children:"max-rows"})," - ",(0,s.jsx)(n.em,{children:"[Present in batched daemons]"})," Provide a limit of the number of operations a single instance of a daemon can run in an iteration."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"dry-run"})," - Run once, showing logs of the daemon's operations without performing any action. Useful for verifying settings of the instance and daemon."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"vos"})," - ",(0,s.jsx)(n.em,{children:"[Present in Multi-VO daemons]"})," Provide a list of VOs with which the daemon can interact. Used when VOs use different settings for their daemons."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"batched-daemons",children:"Batched Daemons"}),"\n",(0,s.jsxs)(n.p,{children:["Some daemons can run over large backlogs depending on the traffic of an instance.\nTo prevent the daemon from running too long, or submitting too many requests at once to an external system, a daemon's workload can be batched.\nBetween batches of work, the daemon sleeps for ",(0,s.jsx)(n.code,{children:"sleep-time"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"This setting is present in daemons that either submit requests (e.g. transfer requests) or process multiple replicas or DIDs (e.g. setting statuses, running deletion)."}),"\n",(0,s.jsx)(n.h3,{id:"threaded-daemons",children:"Threaded Daemons"}),"\n",(0,s.jsxs)(n.p,{children:["When daemons are run with threaded arguments, the database query used by the daemons has a ",(0,s.jsx)(n.code,{children:"threads"})," argument applied to the query string.\nThis is applicable to ",(0,s.jsx)(n.code,{children:"oracle"}),", ",(0,s.jsx)(n.code,{children:"postgres"})," and ",(0,s.jsx)(n.code,{children:"mysql"})," databases."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Note:"})}),"\nThis definition doesn't apply for producer/consumer daemons. When producer/consumer daemons are run in threaded mode, it creates multiple instances of producers and consumers. This includes the threaded ",(0,s.jsx)(n.code,{children:"conveyor"})," daemons."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"multi-vo-daemons",children:"Multi-VO Daemons"}),"\n",(0,s.jsxs)(n.p,{children:["Daemons that have a ",(0,s.jsx)(n.code,{children:"vos"})," option can be set to have separate settings per vo running in a multi-vo instance.\nWhen this is set, the daemon will only interact with objects that are explicitly included in the specific VO."]}),"\n",(0,s.jsxs)(n.p,{children:["By default, a daemon with multi-VO options interact with all VOs on the instance.\nFor example, this is the log displayed by the ",(0,s.jsx)(n.code,{children:"replica-recoverer"})," daemon."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ rucio-replica-recoverer --run-once\n2020-07-28 15:15:14,151 5461    INFO    replica_recoverer: This instance will work on VOs: def, abc, xyz, 123\n\n\n$ rucio-replica-recoverer --run-once --vos abc xyz\n2020-07-28 15:16:36,066 5474    INFO    replica_recoverer: This instance will work on VOs: abc, xyz\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.em,{children:"Note:"})}),"\nMulti-VO daemons can still be used in single-VO instances, and the ",(0,s.jsx)(n.code,{children:"vos"})," option does not need to be set."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);