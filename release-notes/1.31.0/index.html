<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-release-notes/1.31.0">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><title data-rh="true">1.31.0 | Rucio Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/release-notes/1.31.0"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="1.31.0 | Rucio Documentation"><meta data-rh="true" name="description" content="Upgrade Instructions"><meta data-rh="true" property="og:description" content="Upgrade Instructions"><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/release-notes/1.31.0"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/release-notes/1.31.0" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/release-notes/1.31.0" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documentation/assets/css/styles.ea8558e5.css">
<link rel="preload" href="/documentation/assets/js/runtime~main.f1046afb.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.528b0752.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedImage_ToTc themedImage--light_HNdA"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a class="navbar__item navbar__link" href="/documentation/client_api/accountclient">Python Client API</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>1.31.0</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrade-instructions">Upgrade Instructions<a class="hash-link" href="#upgrade-instructions" title="Direct link to heading">​</a></h2><p>This feature release requires a database schema upgrade. Please consult the <a href="https://rucio.cern.ch/documentation/database/" target="_blank" rel="noopener noreferrer">documentation</a> about upgrading your database schema.</p><p>The following changes are necessary and are covered by the <code>alembic upgrade head</code> command:</p><ol><li>Adding <code>REPLICAS_RSE_ID_TOMBSTONE_IDX</code> to <code>replicas</code> table; <strong>CAUTION</strong>: If you add this index online, make sure the index is fully built before you deploy 1.31!</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="important-changes">Important changes<a class="hash-link" href="#important-changes" title="Direct link to heading">​</a></h2><ul><li>This release enables the usage of temporary tables per default. Previously, this was an opt-in, now it is an opt-out. If you notice any issues due to this change, you can turn the usage of temporary tables off via setting the <code>[core]use_temp_tables=False</code> setting in the config table.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="helm-chart-changes">Helm chart changes<a class="hash-link" href="#helm-chart-changes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="breaking-change-version-131x-of-rucio-servers-helm-chart-is-incompatible-with-old-values">breaking change: Version <code>1.31.x</code> of <code>rucio-servers</code> helm chart is incompatible with old values<a class="hash-link" href="#breaking-change-version-131x-of-rucio-servers-helm-chart-is-incompatible-with-old-values" title="Direct link to heading">​</a></h3><p><strong>What changes?</strong>
The <code>rucio-server</code> helm chart doesn&#x27;t support anymore to deploy separate <code>api</code>, <code>auth</code> and <code>trace</code> servers. Only a single server deployment can be done by one helm release.</p><p>There are two possible cases.
1) If your helm values don&#x27;t set any of the <code>authReplicaCount</code> or <code>traceReplicaCount</code> (or set them to <code>0</code>), the impact of this release will be very limited on you.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- If you have any of the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `authService`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `traceService`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `authIngress`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `traceIngress`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `authServerResources`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `traceServerResources`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `authServerResources`</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sections set in the values. They were already ignored anyway because of</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  `authReplicaCount` and `traceReplicaCount` not being set. You can safely</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  remove these sections</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>After that, you&#x27;ll have to substitute any of the following constructs: </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">exposeErrorLogs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: ... </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">useSSL:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">minReadySeconds:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">readinessProbe:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelaySeconds: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">livenessProbe:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    initialDelaySeconds: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">serverType:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">logFormat:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  server: ... </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> with </p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">exposeErrorLogs: ... </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">useSSL: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">minReadySeconds: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">readinessProbe:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  initialDelaySeconds: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">livenessProbe:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  initialDelaySeconds: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">serverType: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">logFormat: ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p> if any of the sections have an <code>authServer</code> or <code>traceServer</code> attribute, it can be removed.</p></li></ul><p>2) If your values set <code>authReplicaCount</code> or <code>traceReplicaCount</code> to any positive integer, you&#x27;ll have to split your helm release into multiple helm releases.</p><p>   For example. An initial helm release with values.yaml like following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   replicaCount: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   authReplicaCount: 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   traceReplicaCount: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   service: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      something</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   authService</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      anotherThing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   traceService</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      thirdThing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   useSSL:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      server: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      authServer: true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>   Will have to become 3 different helm releases with following values: </p><ul><li><p>api servers:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">replicaCount: 3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   something</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">useSSL: false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>auth servers:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">replicaCount: 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   anotherThing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">useSSL: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  api:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    endpoints: &quot;ping, auth&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>trace servers:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">replicaCount: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">service: </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   thirdThing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">config:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  api:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    endpoints: &quot;ping, traces, nongrid_traces&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><strong>Why this change?</strong>
The helm chart was difficult to maintain and had a lot of duplicate code to support an edge case for which a reasonable work-around exists. The behavior of the chart was also not consistent between <code>trace</code> and <code>auth</code> servers. Moreover, it didn&#x27;t allow to set distinct parameters for those servers. Rather than trying to complicate things even further and fix inconsistent behavior, it was decided it&#x27;s a better way forward to drop support for it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="highly-recommended-change-rework-of-the-additionalsecrets-section">Highly recommended change: rework of the <code>additionalSecrets</code> section<a class="hash-link" href="#highly-recommended-change-rework-of-the-additionalsecrets-section" title="Direct link to heading">​</a></h3><p><strong>What changes?</strong>
Support for <code>additionalSecrets</code> will be dropped in a future major release. To be ready for that change, you can already migrate to the new format, for both <code>rucio-servers</code> and <code>rucio-daemons</code> helm charts. The old format will still be supported throughout the whole 1.31, but will be dropped in 1.32.</p><p>Substituted all occurrences of:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">additionalSecrets:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  volumename:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    secretName: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mountPath: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    subPath: ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>with:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">secretMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - secretName: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mountPath: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    subPath: ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    volumeName: volumename  # volumeName is optional in most cases and will be inferred from secretName if ommited </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Why this change?</strong>
Avoiding user-input keys in the yaml object (here: the volume name) is more consistent with the overall kubernetes best practices. User input is always passed via yaml values, not via yaml keys. One of the consequences of this change is improved support for kubernetes kustomize. Secrets can now be referred via the <code>fieldSpecs.path</code> fields in kustomize.</p><p>Renaming <code>additionalSecrets</code> to <code>secretMount</code> is a cosmetic change. The new name seems to better reflect the function of this section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recommended-change-rework-of-ftsrenewal-section">Recommended change: rework of ftsRenewal section<a class="hash-link" href="#recommended-change-rework-of-ftsrenewal-section" title="Direct link to heading">​</a></h3><p><strong>What changes?</strong>
The <code>ftsRenewal</code> sections in both <code>rucio-servers</code> and <code>rucio-daemons</code> helm charts suffered a major rework. The old format will still be supported throughout the whole 1.31 release line. There is no plan to drop support of the old format in 1.32, but we may decide to do so if the maintenance burden will be judged too high in the meantime. </p><p>In the new format, secrets and env variable have to be specified explicitly, rather than being selected implicitly depending on the &#x27;vo&#x27; attribute.
See the documentation: <a href="https://github.com/rucio/helm-charts/tree/master/charts/rucio-daemons#conveyor" target="_blank" rel="noopener noreferrer">https://github.com/rucio/helm-charts/tree/master/charts/rucio-daemons#conveyor</a> and helm values: <a href="https://github.com/rucio/helm-charts/blob/master/charts/rucio-daemons/values.yaml#L408" target="_blank" rel="noopener noreferrer">https://github.com/rucio/helm-charts/blob/master/charts/rucio-daemons/values.yaml#L408</a> for example of new configuration.</p><p><strong>Why this change?</strong>
Two independent reasons:
1) the new format introduced support for multi-vo.
2) the source code of ftsRenewal cronjob became full of if/else to support vo-specific configurations. Configuring a new VO, with different requirements, was very difficult and required co-ordinated changes in multiple upstream rucio repositories. The new format is now much more flexible, but this comes at the price of increased verbosity of the configuration</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="your-opinion-is-welcomed-deprecation-of-implicit-secrets">Your opinion is welcomed: deprecation of implicit secrets<a class="hash-link" href="#your-opinion-is-welcomed-deprecation-of-implicit-secrets" title="Direct link to heading">​</a></h3><p><strong>What changes?</strong>
Nothing, yet. But we are evaluating the possibility to deprecate implicit secrets required by helm charts. If the community will not be against removing support for implicit secrets, the support will be gradually removed in future major releases.</p><p>If you want to participate and provide your opinion, you&#x27;ll have to set <code>useDeprecatedImplicitSecrets: false</code> in helm charts. This way, some secrets will not be automatically mounted into the containers. You&#x27;ll have to explicitly mount corresponding secrets via helm values:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">secretMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- secretFullName: releasename-rucio-x509up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mountPath: /opt/proxy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- secretFullName: releasename-rucio-ca-bundle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mountPath: /opt/certs/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">automatix:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  extraSecretMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - secretFullName: releasename-rucio-ca-bundle-reaper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mountPath: /etc/grid-security/certificates/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reaper:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  extraSecretMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - secretFullName: releasename-rucio-ca-bundle-reaper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mountPath: /etc/grid-security/certificates/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">darkReaper:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  extraSecretMounts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - secretFullName: releasename-rucio-ca-bundle-reaper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      mountPath: /etc/grid-security/certificates/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Why this change?</strong>
We consider that explicit declaration of dependencies in helm charts is a better practice. Requiring secrets with specific names to be created inside the cluster before running the helm chart is very confusing to new users. </p><p>This change also allows you to pick a different name for the secrets and share them between multiple helm releases.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="general">General<a class="hash-link" href="#general" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="features">Features<a class="hash-link" href="#features" title="Direct link to heading">​</a></h3><ul><li>Metadata: Merge list_dids and list_dids_extended methods <a href="https://github.com/rucio/rucio/issues/5448" target="_blank" rel="noopener noreferrer">#5448</a></li><li>Recovery: Allow for file recovery policies based on scope <a href="https://github.com/rucio/rucio/issues/5928" target="_blank" rel="noopener noreferrer">#5928</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enhancements">Enhancements<a class="hash-link" href="#enhancements" title="Direct link to heading">​</a></h3><ul><li>Core &amp; Internals: Unicode support along all Core/API/REST API <a href="https://github.com/rucio/rucio/issues/4045" target="_blank" rel="noopener noreferrer">#4045</a></li><li>Core &amp; Internals: switch ON temporary tables workflows by default <a href="https://github.com/rucio/rucio/issues/6084" target="_blank" rel="noopener noreferrer">#6084</a></li><li>Documentation: Fix broken Rest API docs view <a href="https://github.com/rucio/rucio/issues/4992" target="_blank" rel="noopener noreferrer">#4992</a></li><li>Messaging: Migrate to hermes-2 as default <a href="https://github.com/rucio/rucio/issues/6089" target="_blank" rel="noopener noreferrer">#6089</a></li><li>Use of bulk_insert_mappings in reaper causes issue with Hermes : Closes <a href="https://github.com/rucio/rucio/issues/6152" target="_blank" rel="noopener noreferrer">#6152</a> <a href="https://github.com/rucio/rucio/issues/6153" target="_blank" rel="noopener noreferrer">#6153</a></li><li>Release management: update dependencies for the 1.31 release <a href="https://github.com/rucio/rucio/issues/6110" target="_blank" rel="noopener noreferrer">#6110</a></li><li>Transfers: Remove full_mode switch from conveyor-receiver <a href="https://github.com/rucio/rucio/issues/5453" target="_blank" rel="noopener noreferrer">#5453</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bugs">Bugs<a class="hash-link" href="#bugs" title="Direct link to heading">​</a></h3><ul><li>Messaging: Use of bulk_insert_mappings in reaper causes issue with Hermes <a href="https://github.com/rucio/rucio/issues/6152" target="_blank" rel="noopener noreferrer">#6152</a></li><li>REST &amp; API: create_did_sample broken for DIDs with &quot;/&quot; <a href="https://github.com/rucio/rucio/issues/5608" target="_blank" rel="noopener noreferrer">#5608</a></li><li>Subscriptions: The transmogrifier updates the subscription history table everytime it runs <a href="https://github.com/rucio/rucio/issues/6109" target="_blank" rel="noopener noreferrer">#6109</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="clients">Clients<a class="hash-link" href="#clients" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enhancements-1">Enhancements<a class="hash-link" href="#enhancements-1" title="Direct link to heading">​</a></h3><ul><li>Clients: Use GFAL’s create_parent transfer parameter <a href="https://github.com/rucio/rucio/issues/2973" target="_blank" rel="noopener noreferrer">#2973</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/release-notes/1.31.0.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#upgrade-instructions" class="table-of-contents__link toc-highlight">Upgrade Instructions</a></li><li><a href="#important-changes" class="table-of-contents__link toc-highlight">Important changes</a></li><li><a href="#helm-chart-changes" class="table-of-contents__link toc-highlight">Helm chart changes</a><ul><li><a href="#breaking-change-version-131x-of-rucio-servers-helm-chart-is-incompatible-with-old-values" class="table-of-contents__link toc-highlight">breaking change: Version <code>1.31.x</code> of <code>rucio-servers</code> helm chart is incompatible with old values</a></li><li><a href="#highly-recommended-change-rework-of-the-additionalsecrets-section" class="table-of-contents__link toc-highlight">Highly recommended change: rework of the <code>additionalSecrets</code> section</a></li><li><a href="#recommended-change-rework-of-ftsrenewal-section" class="table-of-contents__link toc-highlight">Recommended change: rework of ftsRenewal section</a></li><li><a href="#your-opinion-is-welcomed-deprecation-of-implicit-secrets" class="table-of-contents__link toc-highlight">Your opinion is welcomed: deprecation of implicit secrets</a></li></ul></li><li><a href="#general" class="table-of-contents__link toc-highlight">General</a><ul><li><a href="#features" class="table-of-contents__link toc-highlight">Features</a></li><li><a href="#enhancements" class="table-of-contents__link toc-highlight">Enhancements</a></li><li><a href="#bugs" class="table-of-contents__link toc-highlight">Bugs</a></li></ul></li><li><a href="#clients" class="table-of-contents__link toc-highlight">Clients</a><ul><li><a href="#enhancements-1" class="table-of-contents__link toc-highlight">Enhancements</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
<script src="/documentation/assets/js/runtime~main.f1046afb.js"></script>
<script src="/documentation/assets/js/main.528b0752.js"></script>
</body>
</html>