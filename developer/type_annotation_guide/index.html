<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-developer/type_annotation_guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Type Annotation Guide | Rucio Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/developer/type_annotation_guide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Type Annotation Guide | Rucio Documentation"><meta data-rh="true" name="description" content="The purpose of this document is to collaboratively create the developer"><meta data-rh="true" property="og:description" content="The purpose of this document is to collaboratively create the developer"><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/developer/type_annotation_guide"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/developer/type_annotation_guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/developer/type_annotation_guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/documentation/assets/css/styles.8d914037.css">
<script src="/documentation/assets/js/runtime~main.c5b32ae5.js" defer="defer"></script>
<script src="/documentation/assets/js/main.f0db88be.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a class="navbar__item navbar__link" href="/documentation/client_api/accountclient">Python Client API</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/started/before_you_get_started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/user/setting_up_the_rucio_client">User</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/operator/setting_up_demo">Operator</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentation/developer/setting_up_mac_apple_silicon">Developer</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/setting_up_mac_apple_silicon">Setting up a Rucio Developer environment on Mac with Apple Silicon</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/setting_up_intellij_dev_env">Setting up a Rucio Developer environment using IntelliJ Ultimate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/setting_up_vscode_dev_env">Setting up a Rucio Developer environment using Visual Studio Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/contributing">Contributing Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/dependency_management">Dependency management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/rest_api_doc">REST API Documentation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/developer/type_annotation_guide">Type Annotation Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/developer/dev_style_guide">Style Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/developer/webui/webui_frontend_vscode_dev_env">WebUI</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/project_organisation">About Us</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Developer</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Type Annotation Guide</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Type Annotation Guide</h1></header><p>The purpose of this document is to collaboratively create the developer
guidelines for static type checking of rucio&#x27;s codebase.</p>
<p><strong>TL;DR</strong> New code has to be type annotated, old code should be migrated. Look
into <a href="/documentation/developer/type_annotation_guide#Best-Practices">Best Practices</a> for specific instructions on how to use
it in our repository.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a class="hash-link" aria-label="Direct link to Abstract" title="Direct link to Abstract" href="/documentation/developer/type_annotation_guide#abstract">​</a></h2>
<p>Python is a dynamically-typed programming language. Dynamic type checked
programming languages verify the type safety at runtime. Type-related bugs thus
occur at runtime. Tests are in place to check the types and prevent
bugs. However, tests do not always cover all possible combinations of types.</p>
<p><a href="https://peps.python.org/pep-0484/" target="_blank" rel="noopener noreferrer">PEP 484</a>, which got adopted into the <em>Python
Language Reference</em> of Python3.6 and is thus a part of Python itself, introduces
<em>type hints</em> to Python. Type hints add more information to the source code and
allow us to automatically check the code for type mismatches. Type-related bugs
will thereby be checked at compile time (pre-runtime), rather than at
runtime. Type hints also increase the descriptiveness of our code and make it
easier to read.</p>
<p>Rucio does not have type hints at the moment. The plan is to introduce them
consistently to the entire project. Adding type hints to a big project is
challenging. Since the code-base is too large to introduce them with only one
PR, we will introduce the hints incrementally.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-annotations">Type Annotations<a class="hash-link" aria-label="Direct link to Type Annotations" title="Direct link to Type Annotations" href="/documentation/developer/type_annotation_guide#type-annotations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-information">General Information<a class="hash-link" aria-label="Direct link to General Information" title="Direct link to General Information" href="/documentation/developer/type_annotation_guide#general-information">​</a></h3>
<ul>
<li><a href="https://peps.python.org/pep-0483/" target="_blank" rel="noopener noreferrer"><strong>PEP 483 – The Theory of Type Hints</strong></a>
This <em>PEP</em> explains the theory behind type hints, as well as backgrounds to
certain decisions.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax" href="/documentation/developer/type_annotation_guide#syntax">​</a></h3>
<p>There are comprehensive and descriptive documentations on the web on how to
annotate python code with type hints. E.g.:</p>
<ul>
<li>
<p><a href="https://mypy.readthedocs.io/en/stable/cheat_sheet_py3.html" target="_blank" rel="noopener noreferrer"><strong>MyPy type hints cheat
sheet</strong></a> The cheat
sheet contains information on the syntax of type annotations and <em>which ones</em>
to use <em>when</em>.</p>
</li>
<li>
<p><a href="https://peps.python.org/pep-0484/" target="_blank" rel="noopener noreferrer"><strong>PEP 484 – Type Hints</strong></a> Contains general
information about type hints in Python. This includes the motivation, the
definition, what to do with edge cases, and much more.</p>
</li>
<li>
<p><a href="https://peps.python.org/pep-0589/" target="_blank" rel="noopener noreferrer"><strong>PEP 589 – TypedDict: Type Hints for Dictionaries with a Fixed Set of
Keys</strong></a> Explains how to use <code>TypedDict</code> and
what to regard while using them.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why">Why<a class="hash-link" aria-label="Direct link to Why" title="Direct link to Why" href="/documentation/developer/type_annotation_guide#why">​</a></h2>
<p>Dynamically typed programming languages execute many common programming
behaviours, that static programming languages perform during compilation, at
runtime. While this leads to quick prototyping, big projects could suffer
from some consequences. In particular:</p>
<ul>
<li>The code is harder to read: Parameters and return types are specified in typed
languages, they give some hints on how to call a function and what to
expect. Bugs and inconsistencies can be easier to spot (e.g. when a &quot;get&quot;
function return a list), and some IDEs display these information for a more
convenient coding experience. All of this is missing in dynamically typed
programming languages.</li>
<li>Type related bugs do not get noticed: Calling a function with a wrong type
(e.g. <code>None</code>) gets spotet by typed checkers. In dynamically typed programming
languages this needs to be veryfied on every call.</li>
</ul>
<p>While we have strong arguments for type annotations, there are some drawbacks:</p>
<ul>
<li>It takes more time to write code: The type annotations need to be specified
and added, which is tedious in a big code base.</li>
<li>They add little value if dicts are used heavily: The keys of dicts are not
type checked, only the potential values. Big dictionaries thus have a lot of
different value types, while the check if a key exists still needs to be done.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-annotations-in-rucio">Type Annotations in Rucio<a class="hash-link" aria-label="Direct link to Type Annotations in Rucio" title="Direct link to Type Annotations in Rucio" href="/documentation/developer/type_annotation_guide#type-annotations-in-rucio">​</a></h2>
<p>Adding type annotations is not always trivial. Some types might be to ambiguous,
some might be too generic. A good reference point is existing type annotated
<em>Rucio</em> code. It will give hints on what types may be used and how to properly
use them in the code.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Don&#x27;t just copy the types from existing code, think about them!</p><p>Ask yourself: Is this use-case the same? Could I be more specific than just
<code>Any</code>. Could I use a class instead of a <code>Dict</code>? Should I introduce a new type
instead of using an existing one? ...</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-not-to-type-annotate">What not to type annotate<a class="hash-link" aria-label="Direct link to What not to type annotate" title="Direct link to What not to type annotate" href="/documentation/developer/type_annotation_guide#what-not-to-type-annotate">​</a></h3>
<p>Not all Python code needs type annotations. Type annotations in the <code>tests</code>, for
example, would just add clutter and add very little benefits.</p>
<p>The following modules will <strong>not</strong> be type annotated:</p>
<ul>
<li><code>tools</code>
<ul>
<li>The tools folder contains some Python scripts. While type annotations
would help fixing bugs, the code itself is not shipped and will not be run
in a production environment.</li>
<li>We could add support later, however this is not our main concern atm.</li>
</ul>
</li>
<li><code>bin</code>
<ul>
<li>The Rucio executables don&#x27;t call the core or api call directly, but rather
use the client. We could activate it once to Python2 support is dropped.</li>
</ul>
</li>
<li><code>lib/rucio/tests</code>
<ul>
<li>The tests are volatile and should be easy to change. Type annotations
would just add clutter and very little benefits.</li>
</ul>
</li>
<li><code>lib/rucio/db</code>
<ul>
<li>The db module is used as a dependency of core. While we need the types, we
use very little functions out of it. We might activate support later,
however we want to focus on core right now.</li>
</ul>
</li>
<li><code>lib/rucio/core/oidc.py</code>
<ul>
<li><code>pyjwkest</code> is no longer maintained and needs to be replaced,
and some functions are planned to be removed in the future.
It is best to skip this file for now.</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies" href="/documentation/developer/type_annotation_guide#dependencies">​</a></h3>
<p>To properly use the benefits of type annotated code, we also have to look into
our dependencies. All of our frequently used dependencies provide type
annotations out of the box or via extensions:</p>
<ul>
<li><em>Python standard library</em>
<ul>
<li>Typehints were added in 3.5.0</li>
</ul>
</li>
<li><code>sqlalchemy</code>
<ul>
<li>Type hints were introduced in version 2.0</li>
<li><code>sqlalchemy-stubs</code> provide types for versions &lt; 2.0</li>
</ul>
</li>
<li><code>alembic</code>
<ul>
<li>Type hints are provided. Not important at the moment, since we are not
adding type hints for the db migration.</li>
</ul>
</li>
<li><code>flask</code>
<ul>
<li>Type hints are provided</li>
</ul>
</li>
<li><code>six</code>
<ul>
<li>The <code>types-six</code> package provides typehints.</li>
<li><code>six</code> might be removed from the repository in the future.</li>
</ul>
</li>
<li><code>requests</code>
<ul>
<li>The <code>types-requests</code> package provides typehints.</li>
</ul>
</li>
</ul>
<p>Some types from our dependencies, like the <em>sqlalchemy</em> <code>orm.session.Session</code>,
can be used directly. It is not needed to create our own equivalent then, except
if they get translated to a rucio owned type.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="github-actions">GitHub Actions<a class="hash-link" aria-label="Direct link to GitHub Actions" title="Direct link to GitHub Actions" href="/documentation/developer/type_annotation_guide#github-actions">​</a></h3>
<p>A GitHub actions job ensures that newly written code contains type hints:</p>
<p>The <code>Check Python Type Annotations</code> job in the autotests checks, if new code
contains type annotations. It does this by comparing the number of missing
python type annotations before the changes with the number of missing python
type annotations after the changes. If the number before is less than the number
after, new code, which is not typed, was added. The script then exits with a
non-zero exit code. If it is equals or bigger, type annotations have been added
to the repository.</p>
<p>As of now, only the number of <em>missing</em> type annotations will be used. The job
does not check for wrong type hints or inconsistencies. This (specifically
<code>mypy</code>) will be enabled once enough python type hints are added. For this
purpose, we will always add type annotations to functions, even when the type
can be infered.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" href="/documentation/developer/type_annotation_guide#best-practices">​</a></h3>
<p>To ensure a consistent usage of type hints, you should pay attention to the
following best practices:</p>
<p><strong>Use <em>Python 3.6</em> style type hints</strong></p>
<ul>
<li>There are multiple ways to specify type hints in Python. We agreed to use
the Python 3.6 style, since it&#x27;s easy to read and we don&#x27;t need the
backwards-compatibility.</li>
<li>E.g. favor <code>def add_rse(rse: str, vo: str = &#x27;def&#x27;, ...) -&gt; str:</code> over <code>def   add_rse(rse, vo=&#x27;def&#x27;, ...): # type: (str, str, ...) -&gt; str</code></li>
</ul>
<p><strong>Use <em>bare</em> type hints over <a href="https://peps.python.org/pep-0484/#runtime-or-type-checking" target="_blank" rel="noopener noreferrer">ones with
quotes</a> and <code>if tying.TYPE_CHECKING:</code></strong></p>
<ul>
<li>Quoted type hints enable &quot;forward references&quot;. This enables us to not
execute expensive code while still having type checks.</li>
<li>As long as the performance is immesurable small and not a problem, this
should be avoided, since it &gt; [name=Joel Dierkes] Dunno about this part. Should
we use <code>if typing.TYPE_CHECKING:</code> and quoted types or avoid them?</li>
</ul>
<p><strong>Be as specific as possible</strong></p>
<ul>
<li>If the types of the keys and values of a dict are known, specify
them. (E.g. Use <code>Dict[str, str]</code> over <code>Dict</code>).</li>
<li>If the types of all items in a list are known, specify them
(E.g. <code>List[int]</code> over <code>List</code>)</li>
<li>...</li>
</ul>
<p><strong>Avoid <code>Dicts</code></strong></p>
<ul>
<li>Strongly typed structures should be preferred, since they are more
descriptive and easier to use in the future.</li>
<li>&quot;Was the id key in the <code>Dict</code> named <code>_id</code> or <code>id</code>?&quot; is a question that
should not occur.</li>
</ul>
<p><strong>Avoid the <code>Optional</code> type</strong></p>
<ul>
<li>The <code>Optional</code> type highlights that a value <em>might</em> be <code>None</code>. As a result
the value <em>has</em> to be checked for <code>None</code> on every usage (<code>if value: </code>).</li>
<li>While sometimes this cannot be avoided, the <code>Optional</code> type should be used
sparely. Most of the times a proper initialization of the variable is
enough to get rid of it. If it makes sense that a type can be
&quot;non-existent&quot;, it is appropriate to use the <code>Option</code> type.</li>
</ul>
<p><strong>Avoid the <code>Union</code> type</strong></p>
<ul>
<li>The <code>Union</code> type indicates, that one of multiple different types may be
returned. This can be confusing and resolves in the need of testing, which
type is returned.</li>
<li>Split the function or variable, which used the <code>Union</code> type, in multiple
ones. This resolves in more readable code and is unambiguous. This also
follows the <code>A function does one, and only one thing</code> rule.</li>
</ul>
<p><strong>Use
<a href="https://docs.python.org/3/library/typing.html#typing.NoReturn" target="_blank" rel="noopener noreferrer"><code>typing.NoReturn</code></a></strong></p>
<ul>
<li>It is used to indicate a never terminating function (e.g. <code>while   True:</code>). Use this annotation to indicate these kind of functions.</li>
</ul>
<p><strong>Use
<a href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Iterator" target="_blank" rel="noopener noreferrer"><code>collections.abc.Iterator</code></a>
over
<a href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Generator" target="_blank" rel="noopener noreferrer"><code>collections.abc.Generator</code></a></strong></p>
<ul>
<li><code>collections.abc.Generator[YieldType, SendType, ReturnType]</code> takes three Type Vars:
The Type that gets yielded, the type that gets send back to the yield, and the
return type of the function. If a function does only yield values, but does
not take back values from the yield and also does not return anything with the
<code>return</code> keyword, the type is <code>collections.abc.Generator[YieldType, None, None]</code>. This
is equivalent to <code>collections.abc.Iterator[YieldType]</code>. We favor the <code>Iterator</code>
approach over the <code>Generator</code> one because it&#x27;s more understandable and easier
to read.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="common-types">Common Types<a class="hash-link" aria-label="Direct link to Common Types" title="Direct link to Common Types" href="/documentation/developer/type_annotation_guide#common-types">​</a></h3>
<p>To ensure a consistent use of type annotations in Rucio, here is a list of
common variables with their corresponding type:</p>
<table><thead><tr><th>Code section</th><th>Variable</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>*</td><td>session</td><td>sqlalchemy.orm.session.Session</td><td>The sqlalchemy session.</td></tr><tr><td>DID</td><td>scope</td><td><code>str</code></td><td>The scope of a DID.</td></tr><tr><td>DID</td><td>name</td><td><code>str</code></td><td>The name of a DID.</td></tr><tr><td>DID</td><td>account</td><td><code>str</code></td><td>The account name.</td></tr><tr><td>DID</td><td>did_type</td><td><code>str</code></td><td>The DID type.</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/developer/type_annotation_guide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-08-05T13:58:13.000Z" itemprop="dateModified">Aug 5, 2024</time></b> by <b>Riccardo Di Maio</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/developer/rest_api_doc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">REST API Documentation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/developer/dev_style_guide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Style Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#abstract">Abstract</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#type-annotations">Type Annotations</a><ul><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#general-information">General Information</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#syntax">Syntax</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#why">Why</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#type-annotations-in-rucio">Type Annotations in Rucio</a><ul><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#what-not-to-type-annotate">What not to type annotate</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#dependencies">Dependencies</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#github-actions">GitHub Actions</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#best-practices">Best Practices</a></li><li><a class="table-of-contents__link toc-highlight" href="/documentation/developer/type_annotation_guide#common-types">Common Types</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
</body>
</html>