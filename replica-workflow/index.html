<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.74">
<link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Rucio Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Rucio Documentation Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Typical Replica Workflow | Rucio Documentation</title><meta data-react-helmet="true" property="og:url" content="https://rucio.github.io/documentation/replica-workflow"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Typical Replica Workflow | Rucio Documentation"><meta data-react-helmet="true" name="description" content="This section gives an overview of what happens within Rucio, for a typical"><meta data-react-helmet="true" property="og:description" content="This section gives an overview of what happens within Rucio, for a typical"><link data-react-helmet="true" rel="shortcut icon" href="/documentation/img/android-chrome-512x512.png"><link data-react-helmet="true" rel="canonical" href="https://rucio.github.io/documentation/replica-workflow"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/replica-workflow" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://rucio.github.io/documentation/replica-workflow" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documentation/assets/css/styles.ea1ffc63.css">
<link rel="preload" href="/documentation/assets/js/styles.eaa45fc4.js" as="script">
<link rel="preload" href="/documentation/assets/js/runtime~main.4e9adbeb.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.d1004863.js" as="script">
<link rel="preload" href="/documentation/assets/js/1.d9b35000.js" as="script">
<link rel="preload" href="/documentation/assets/js/2.6583d90f.js" as="script">
<link rel="preload" href="/documentation/assets/js/303.2ce48399.js" as="script">
<link rel="preload" href="/documentation/assets/js/306.d42517bd.js" as="script">
<link rel="preload" href="/documentation/assets/js/935f2afb.9562f720.js" as="script">
<link rel="preload" href="/documentation/assets/js/17896441.53d42c58.js" as="script">
<link rel="preload" href="/documentation/assets/js/2df33874.e4fa72fa.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a><a class="navbar__item navbar__link" href="/documentation/rucio_client_api">Client API</a><a class="navbar__item navbar__link" href="/documentation/rucio_rest_api">REST API</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_cxYs react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/documentation/"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="Rucio Documentation" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><strong class="navbar__title">Rucio Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/documentation/rucio_client_api">Client API</a></li><li class="menu__list-item"><a class="menu__link" href="/documentation/rucio_rest_api">REST API</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><main class="docMainContainer_r8cw docMainContainerEnhanced_SOUu"><div class="container padding-vert--lg docItemWrapper_NJLN"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><header><h1 class="docTitle_-X99">Typical Replica Workflow</h1></header><div class="markdown"><p>This section gives an overview of what happens within Rucio, for a typical
replica workflow. Two workflows are described: When a replica is uploaded to
Rucio via a client and when a replica is created by a site to site transfer due
to the creation of a <a href="/documentation/overview_Replica_management.md">replication rule</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="replica-paths-on-storage"></a>Replica paths on storage<a class="hash-link" href="#replica-paths-on-storage" title="Direct link to heading">#</a></h2><p>Rucio has two basic paradigms in deciding the path for a replica on a specific
storage system. <strong>Deterministic</strong> and <strong>Non-deterministic</strong> paths. If we assume
a file whose data identifier is <code>user.jdoe:test.file.1</code>, thus the scope is
<code>user.jdoe</code> and the name is <code>test.file.1</code>. In Rucio a deterministically created
path is a path which can be generated solely knowing the scope and name of a
data identifier (Ignoring the static prefix of the storage endpoint). For a
non-deterministic path additional information describing the file is necessary,
such as meta-data, the dataset the file belongs to, etc.</p><p>Rucio supports pluggable algorithms for both deterministic and non-deterministic
algorithms. This section explains a few of them.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="deterministic-algorithm-based-on-hashes"></a>Deterministic algorithm based on hashes<a class="hash-link" href="#deterministic-algorithm-based-on-hashes" title="Direct link to heading">#</a></h2><p>The hash deterministic algorithm is an algorithm commonly used in Rucio. The
advantage of this algorithm is that, due to the characteristics of cryptographic
hash functions, the files are evenly distributed to directories. This can be an
important characteristic for storage systems whose access performance degrades
based on the number of files in a directory.</p><p>For a data identifier, e.g. <code>user.jdoe:test.file.1</code> a md5-hashsum is calculated
<code>077c8119053bebb168d125034bff64ac</code>. The generated path is then based on the
first four characters of the hashsum. e.g. <code>/07/7c/user.jdoe/test.file.1</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="deterministic-algorithm-based-on-naming-convention"></a>Deterministic algorithm based on naming convention<a class="hash-link" href="#deterministic-algorithm-based-on-naming-convention" title="Direct link to heading">#</a></h2><p>If a specific naming convention is enforced on the filenames, a possible
deterministic algorithm can be based on it.</p><p>For the data identifier <code>user.jdoe:test.file.1</code> the first part of the filename
(<code>test</code>) is extracted and used to generate the path: <code>/test/user.jdoe/file.1</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="non-deterministic-algorithm-based-on-parent-dataset"></a>Non-Deterministic algorithm based on parent dataset<a class="hash-link" href="#non-deterministic-algorithm-based-on-parent-dataset" title="Direct link to heading">#</a></h2><p>If the file is part of a dataset, e.g. <code>data:dataset1234</code> the dataset can be
used in the path of the filename. This is useful for e.g. tape storage systems,
to keep the files belonging to the same dataset on the same tape.</p><p>For the data identifier <code>user.jdoe:test.file.1</code> which is part of the dataset
<code>data:dataset1234</code> the generated path is:
<code>/data/dataset1234/user.jdoe/test.file.1</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="replica-is-uploaded-with-the-command-line-client"></a>Replica is uploaded with the command line client<a class="hash-link" href="#replica-is-uploaded-with-the-command-line-client" title="Direct link to heading">#</a></h2><p>This is a typical workflow when a user uploads multiple files, which are part of
a dataset, via the command line client.</p><ol><li><p>The dataset <code>test.dataset</code> is being registered at the server.  All files, or
datasets are associated to a <a href="/documentation/overview_File_Dataset_Container.md">scope</a>, if
not specifically mentioned the client will assume the default scope of the
user, such as <code>user.jdoe</code>. Thus the full data identifier for the dataset is
<code>user.jdoe:test.dataset</code>.</p></li><li><p>The client queries the RSE information from the server. This not only gives a
list of prioritized write protocols to use but also the information if the
RSE is a deterministic or non-deterministic one.</p></li><li><p>The file replica is registered as <code>COPYING</code> on the RSE.</p></li><li><p>Based on the identified naming algorithm of the RSE and the list of
prioritized write protocols, the file URL is calculated.  e.g. using the hash
algorithm from above:
<code>https://storageserver.organization.org/VO/data/07/7c/user.jdoe/test.file.1</code></p></li><li><p>The file upload is done with the first prioritized protocol. If the upload
fails, step 4 is repeated with the second prioritized protocol, etc.</p></li><li><p>Once the upload is successfully finished, the replica state is changed to
<code>AVAILABLE</code>.</p></li><li><p>Step 3-6 are repeated (done in parallel) with all other files part of the
uploaded dataset.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="replica-is-created-by-a-replication-rule"></a>Replica is created by a replication rule<a class="hash-link" href="#replica-is-created-by-a-replication-rule" title="Direct link to heading">#</a></h2><p>This is a typical workflow if a file already exists in Rucio but the user wants
to replicate it to a different RSE.</p><ol><li><p>The user creates a replication rule for the dataset <code>user.jdoe:test.dataset</code>
at the server.</p></li><li><p>The Rucio server creates internal requests for each single file in the
dataset and puts them in a queue to be read by the data transfer service.</p></li><li><p>The data transfer submitter picks these requests up and queries the
destination RSE information for each file.</p></li><li><p>Based on the identified naming algorithm of the destination RSE it creates
the destination URLs and creates the file replicas in <code>COPYING</code> state.</p></li><li><p>The transfer service then submits the transfer job to the connected transfer
tool (e.g. FTS)</p></li><li><p>Once the transfers are finished the transfer tool notifies Rucio about the
transfer success and the transfer services mark the replicas as <code>AVAILABLE</code>.</p></li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/replica-workflow.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-02-04T09:53:32.000Z" class="lastUpdatedDate_nN9m">2/4/2022</time> by <strong>Martin Barisits</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#replica-paths-on-storage" class="table-of-contents__link">Replica paths on storage</a></li><li><a href="#deterministic-algorithm-based-on-hashes" class="table-of-contents__link">Deterministic algorithm based on hashes</a></li><li><a href="#deterministic-algorithm-based-on-naming-convention" class="table-of-contents__link">Deterministic algorithm based on naming convention</a></li><li><a href="#non-deterministic-algorithm-based-on-parent-dataset" class="table-of-contents__link">Non-Deterministic algorithm based on parent dataset</a></li><li><a href="#replica-is-uploaded-with-the-command-line-client" class="table-of-contents__link">Replica is uploaded with the command line client</a></li><li><a href="#replica-is-created-by-a-replication-rule" class="table-of-contents__link">Replica is created by a replication rule</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></div><div class="footer__copyright">Copyright Â© 2021 CERN</div></div></div></footer></div>
<script src="/documentation/assets/js/styles.eaa45fc4.js"></script>
<script src="/documentation/assets/js/runtime~main.4e9adbeb.js"></script>
<script src="/documentation/assets/js/main.d1004863.js"></script>
<script src="/documentation/assets/js/1.d9b35000.js"></script>
<script src="/documentation/assets/js/2.6583d90f.js"></script>
<script src="/documentation/assets/js/303.2ce48399.js"></script>
<script src="/documentation/assets/js/306.d42517bd.js"></script>
<script src="/documentation/assets/js/935f2afb.9562f720.js"></script>
<script src="/documentation/assets/js/17896441.53d42c58.js"></script>
<script src="/documentation/assets/js/2df33874.e4fa72fa.js"></script>
</body>
</html>