<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>DID Metadata · Rucio Documentation</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Rucio supports adding Metadata on the dids."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="DID Metadata · Rucio Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://rucio.github.io/documentation/"/><meta property="og:description" content="Rucio supports adding Metadata on the dids."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/documentation/img/android-chrome-512x512.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/documentation/css/custom.css"/><link rel="stylesheet" href="/documentation/prism/prism.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/documentation/prism/prism.js"></script><script src="/documentation/js/scrollSpy.js"></script><link rel="stylesheet" href="/documentation/css/main.css"/><script src="/documentation/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/documentation/"><img class="logo" src="/documentation/img/wide_logo2.png" alt="Rucio Documentation"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/documentation/docs/" target="_self">Docs</a></li><li class=""><a href="https://rucio.readthedocs.io/_/downloads/en/next/pdf/" target="_self">Downloads</a></li><li class=""><a href="https://arxiv.org/abs/1902.09857" target="_self">Scientific articles</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Ask me something" title="Ask me something"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">DID Metadata</h1></header><article><div><span><p>Rucio supports adding Metadata on the dids.</p>
<p>Example:</p>
<pre><code class="hljs css language-bash">    <span class="hljs-comment"># Create a dataset to use on the Example</span>
    $ rucio add-dataset mock:testing_metadata

    <span class="hljs-comment"># Add 'optimized' metadata that exist as columns in the did table</span>
    $ rucio <span class="hljs-built_in">set</span>-metadata --did mock:testing_metadata --key panda_id --value 9999

    <span class="hljs-comment"># Add 'generic' metadata. If there is no custom metadata plugin, the plugin 'JSON' will be used</span>
    $ rucio <span class="hljs-built_in">set</span>-metadata --did mock:testing_metadata --key random_key_name --value 8888

    <span class="hljs-comment"># Get the 'optimized' metadata</span>
    $ rucio get-metadata mock:testing_metadata

    <span class="hljs-comment"># Get the Generic metadata</span>
    $ rucio get-metadata mock:testing_metadata --plugin JSON

    <span class="hljs-comment"># Get all the metadata</span>
    $ rucio get-metadata mock:testing_metadata --plugin ALL

    <span class="hljs-comment"># List dids according to metadata</span>
    $ rucio list-dids-extended mock:* --filter <span class="hljs-string">"type=ALL,panda_id=9999"</span>
    $ rucio list-dids-extended mock:* --filter <span class="hljs-string">"type=ALL,random_key_name=8888"</span>
</code></pre>
<p>Even though regular users use metadata out of the box using the CLI, advanced users and Rucio admins should be aware that in the backend there are multiple options on how to store and manage the did metadata per experiment needs.</p>
<p>The concepts of DID Metadata Plugins exists on Rucio. While deploying the Rucio server you can configure which existing did plugins to use or even develop your own.</p>
<p>The default plugin in use the one originally developed for the needs of ATLAS, stores the metadata on fixed columns on the DID table and is the most optimal for the specific metadata.</p>
<p>Another option available is the JSON metadata plugin which stores the metadata in JSON blobs in the relational databased used by the Rucio Server.</p>
<p>When you are trying to add or fetch a VALUE for a given KEY, Rucio which asks in order each configured metadata plugin if it supports this KEY.</p>
<h2><a class="anchor" aria-hidden="true" id="how-to-develop-a-custom-metadata-solution"></a><a href="#how-to-develop-a-custom-metadata-solution" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to develop a custom metadata solution</h2>
<p>The module you develop needs to extend the <a href="/">DidMetaPlugin</a> Abstract class. The methods needed are:</p>
<pre><code class="hljs css language-python">    get_metadata(scope, name, session=<span class="hljs-literal">None</span>)
    <span class="hljs-string">"""
    Returns metadata stored in Plugin for given scope:name
    """</span>

    set_metadata(scope, name, key, value, recursive, session=<span class="hljs-literal">None</span>)
    <span class="hljs-string">"""
    Sets the metadata in Plugin for given scope:name
    """</span>

    delete_metadata(scope, name, key, session=<span class="hljs-literal">None</span>)
    <span class="hljs-string">"""
    Removes the metadata from the Plugin for given scope:name
    """</span>

    list_dids(scope, filters, type=<span class="hljs-string">'collection'</span>, ignore_case=<span class="hljs-literal">False</span>, limit=<span class="hljs-literal">None</span>, offset=<span class="hljs-literal">None</span>, long=<span class="hljs-literal">False</span>, recursive=<span class="hljs-literal">False</span>, session=<span class="hljs-literal">None</span>)
    <span class="hljs-string">"""
    Returns a list of dids for given filters.
    For long = True return should be a list of dictionaries having the keys 'scope', 'name', 'did_type', 'bytes', 'length'.
    For long = False return should be a list of strings containing the did names.
    """</span>

    manages_key(key, session=<span class="hljs-literal">None</span>)
    <span class="hljs-string">"""
    Returns if Plugin is willing to manage metadata with given KEY.
    Some Plugins might decide to accept only specific hardcoded keys, others might match against a particular regex while other might accept all possible keys.
    """</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="how-to-configure-which-metadata-plugin-to-use"></a><a href="#how-to-configure-which-metadata-plugin-to-use" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to configure which metadata plugin to use</h2>
<p>Configuration options for Metadata are::</p>
<pre><code class="hljs css language-python">    [metadata]
    <span class="hljs-comment"># plugins = [list_of_plugins,comma_separated]</span>
    plugins = [rucio.core.did_meta_plugins.did_column_meta.DidColumnMeta, escape.rucio.did_meta_plugin]
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#how-to-develop-a-custom-metadata-solution">How to develop a custom metadata solution</a></li><li><a href="#how-to-configure-which-metadata-plugin-to-use">How to configure which metadata plugin to use</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2021 CERN. Created with Docusaurus.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '04e5d623b96121df11ac440e51fc8956',
                indexName: 'rucio-cern',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>