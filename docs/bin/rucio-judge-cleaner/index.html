<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Running rucio-judge-cleaner · Rucio Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="```"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Running rucio-judge-cleaner · Rucio Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://rucio.github.io/documentation/"/><meta property="og:description" content="```"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/documentation/img/android-chrome-512x512.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/documentation/css/custom.css"/><link rel="stylesheet" href="/documentation/prism/prism.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&amp;display=swap"/><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/documentation/prism/prism.js"></script><script src="/documentation/js/scrollSpy.js"></script><link rel="stylesheet" href="/documentation/css/main.css"/><script src="/documentation/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/documentation/"><img class="logo" src="/documentation/img/wide_logo2.png" alt="Rucio Documentation"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/documentation/docs/" target="_self">Docs</a></li><li class=""><a href="https://rucio.readthedocs.io/_/downloads/en/next/pdf/" target="_self">Downloads</a></li><li class=""><a href="https://arxiv.org/abs/1902.09857" target="_self">Scientific articles</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Ask me something" title="Ask me something"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Running rucio-judge-cleaner</h1></header><article><div><span><pre><code class="hljs"><span class="hljs-attribute">usage</span>: rucio-judge-cleaner [-h] [--run-once] [--threads THREADS]

<span class="livecodeserver">The Judge-Cleaner daemon is responsible <span class="hljs-keyword">for</span> cleaning expired replication
rules. It deletes rules <span class="hljs-keyword">by</span> checking <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> <span class="hljs-string">'expired_at'</span> <span class="hljs-built_in">date</span> property is older
than <span class="hljs-keyword">the</span> current timestamp. If <span class="hljs-keyword">the</span> rule is expired, <span class="hljs-keyword">it</span> will <span class="hljs-keyword">first</span> remove <span class="hljs-literal">one</span>
lock <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> replica <span class="hljs-keyword">and</span> parent datasets <span class="hljs-keyword">if</span> <span class="hljs-keyword">the</span> DID belongs <span class="hljs-built_in">to</span> <span class="hljs-keyword">any</span>. Then <span class="hljs-keyword">it</span>
will <span class="hljs-built_in">set</span> <span class="hljs-keyword">a</span> tombstone <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> replica <span class="hljs-built_in">to</span> mark <span class="hljs-keyword">it</span> <span class="hljs-keyword">as</span> deletable <span class="hljs-keyword">if</span> there are no
rules protecting <span class="hljs-keyword">the</span> replica. After these steps, <span class="hljs-keyword">the</span> rule gets deleted.

optional arguments:
  -h, <span class="hljs-comment">--help         show this help message and exit</span>
  <span class="hljs-comment">--run-once         One iteration only</span>
  <span class="hljs-comment">--threads THREADS  Concurrency control: total number of threads on this</span>
                     <span class="hljs-built_in">process</span>

Upload <span class="hljs-keyword">a</span> <span class="hljs-built_in">file</span> <span class="hljs-built_in">to</span> your RSE:: $ rucio upload <span class="hljs-comment">--rse MOCK --scope mock --name file</span>
filename.txt Set <span class="hljs-keyword">a</span> replication rule <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">with</span> <span class="hljs-keyword">a</span> lifetime <span class="hljs-keyword">of</span> <span class="hljs-literal">one</span>
<span class="hljs-keyword">second</span>:: $ rucio <span class="hljs-built_in">add</span>-rule mock:<span class="hljs-built_in">file</span> <span class="hljs-number">1</span> MOCK2 <span class="hljs-comment">--lifetime 1 Check the replication</span>
rules <span class="hljs-keyword">and</span> <span class="hljs-keyword">the</span> replicas:: $ rucio list-rules mock:<span class="hljs-built_in">file</span> ID ACCOUNT SCOPE:NAME
STATE[OK/REPL/STUCK] RSE_EXPRESSION COPIES EXPIRES (UTC) CREATED (UTC)
<span class="hljs-comment">-------------------------------- --------- ------------ ----------------------</span>
<span class="hljs-comment">---------------- -------- ------------------- -------------------</span>
c273c7ed75724143ad21c667e659456b root mock:<span class="hljs-built_in">file</span> REPLICATING[<span class="hljs-number">0</span>/<span class="hljs-number">1</span>/<span class="hljs-number">0</span>] MOCK2 <span class="hljs-number">1</span>
<span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-03</span> <span class="hljs-number">09</span>:<span class="hljs-number">53</span>:<span class="hljs-number">09</span> <span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-03</span> <span class="hljs-number">09</span>:<span class="hljs-number">53</span>:<span class="hljs-number">08</span> <span class="hljs-number">06</span>f012771b0546dca0c908441c048964 root
mock:<span class="hljs-built_in">file</span> OK[<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span>] MOCK <span class="hljs-number">1</span> <span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-03</span> <span class="hljs-number">09</span>:<span class="hljs-number">52</span>:<span class="hljs-number">19</span> $ python <span class="hljs-built_in">from</span> rucio.db.sqla
import session, models <span class="hljs-built_in">from</span> rucio.core.rse import get_rse_id rse_id =
get_rse_id(<span class="hljs-string">'MOCK2'</span>)
session.get_session().query(models.RSEFileAssociation).filter_by(name=<span class="hljs-string">'file'</span>,
scope=<span class="hljs-string">'mock'</span>, rse_id=rse_id).<span class="hljs-keyword">first</span>().tombstone<span class="hljs-comment"> // None</span>
session.get_session().query(models.RSEFileAssociation).filter_by(name=<span class="hljs-string">'file'</span>,
scope=<span class="hljs-string">'mock'</span>, rse_id=rse_id).<span class="hljs-keyword">first</span>().lock_cnt<span class="hljs-comment"> // 1 The first rule was created</span>
<span class="hljs-keyword">with</span> <span class="hljs-keyword">an</span> expiration <span class="hljs-built_in">date</span> <span class="hljs-keyword">of</span> <span class="hljs-literal">one</span> <span class="hljs-keyword">second</span> <span class="hljs-keyword">after</span> <span class="hljs-keyword">the</span> creation <span class="hljs-built_in">date</span>. Run <span class="hljs-keyword">the</span>
daemon:: $ rucio-judge-cleaner <span class="hljs-comment">--run-once Check the replication rules and the</span>
replicas:: $ rucio list-rules mock:<span class="hljs-built_in">file</span> ID ACCOUNT SCOPE:NAME
STATE[OK/REPL/STUCK] RSE_EXPRESSION COPIES EXPIRES (UTC) CREATED (UTC)
<span class="hljs-comment">-------------------------------- --------- ------------ ----------------------</span>
<span class="hljs-comment">---------------- -------- --------------- -------------------</span>
<span class="hljs-number">06</span>f012771b0546dca0c908441c048964 root mock:<span class="hljs-built_in">file</span> OK[<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span>] MOCK <span class="hljs-number">1</span> <span class="hljs-number">2018</span><span class="hljs-number">-12</span><span class="hljs-number">-03</span>
<span class="hljs-number">09</span>:<span class="hljs-number">52</span>:<span class="hljs-number">19</span> $ python <span class="hljs-built_in">from</span> rucio.db.sqla import session, models <span class="hljs-built_in">from</span>
rucio.core.rse import get_rse_id rse_id = get_rse_id(<span class="hljs-string">'MOCK2'</span>)
session.get_session().query(models.RSEFileAssociation).filter_by(name=<span class="hljs-string">'file'</span>,
scope=<span class="hljs-string">'mock'</span>, rse_id=rse_id).<span class="hljs-keyword">first</span>().tombstone<span class="hljs-comment"> // datetime.datetime(1970, 1,</span>
<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
session.get_session().query(models.RSEFileAssociation).filter_by(name=<span class="hljs-string">'file'</span>,
scope=<span class="hljs-string">'mock'</span>, rse_id=rse_id).<span class="hljs-keyword">first</span>().lock_cnt<span class="hljs-comment"> // 0 The rule we created before</span>
was deleted <span class="hljs-keyword">and</span> <span class="hljs-keyword">the</span> replica <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> <span class="hljs-built_in">file</span> <span class="hljs-keyword">on</span> <span class="hljs-title">RSE</span> <span class="hljs-title">MOCK2</span> <span class="hljs-title">got</span> <span class="hljs-title">a</span> <span class="hljs-title">tombstone</span> <span class="hljs-title">because</span>
there is no protecting rule anymore.
</span></code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2021 CERN. Created with Docusaurus.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '04e5d623b96121df11ac440e51fc8956',
                indexName: 'rucio-cern',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>