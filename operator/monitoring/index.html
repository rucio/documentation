<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-operator/monitoring" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Monitoring | Rucio Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/operator/monitoring"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Monitoring | Rucio Documentation"><meta data-rh="true" name="description" content="Rucio provides multiple monitoring components to observe its internal operations, data transfers, file access, and database state. These components include:"><meta data-rh="true" property="og:description" content="Rucio provides multiple monitoring components to observe its internal operations, data transfers, file access, and database state. These components include:"><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/operator/monitoring"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/monitoring" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Monitoring","item":"https://rucio.github.io/documentation/operator/monitoring"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">

<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/documentation/assets/css/styles.1dc85473.css">
<script src="/documentation/assets/js/runtime~main.39b09920.js" defer="defer"></script>
<script src="/documentation/assets/js/main.6f5702aa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_black.svg"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a href="/documentation/html/client_api/accountclient.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Python Client API</a><a class="navbar__item navbar__link" href="/documentation/bin/rucio">Command Line Client</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/contributing">Contributing Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/started/before_you_get_started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/user/setting_up_the_rucio_client">User</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentation/operator/setting_up_demo">Operator</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/setting_up_demo">Setting up a Rucio demo environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/kubernetes">Setting up Rucio on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_server">Installing Rucio Server</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/documentation/operator/policy_packages/policy_packages_overview">Policy Packages</a><button aria-label="Expand sidebar category &#x27;Policy Packages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_daemons">Installing Rucio Daemons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/administration">Administration Tricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration_parameters">Configuration Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/database">Database Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/did_meta">DID Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/jupyter_extension_operator">JupyterLab Extension</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/k8s_guide">A Kubernetes tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/operator/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/multi_vo_rucio">Multi-VO Rucio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/notifications">Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/open_data">Open Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/qos_rse_config">QoS RSE Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/s3_rse_config">S3 Storage Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/suspicious-replica-recoverer">Suspicious Replica Recoverer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/operator_transfers/configure-rucio-fts3-plugins">Transfers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/bin/rucio-abacus-account">Executables</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/developer/dependency_management">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/project_organisation">About Us</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operator</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Monitoring</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Rucio Monitoring Guide</h1></header>
<p>Rucio provides multiple monitoring components to observe its internal operations, data transfers, file access, and database state. These components include:</p>
<ul>
<li><a href="#internal-monitoring"><strong>Internal Monitoring</strong></a>: Observing Rucio server and daemon performance.</li>
<li><a href="#transfers-deletion-and-other-monitoring"><strong>Transfers, Deletion, and Other Monitoring</strong></a>: Tracking transfers, deletions, and other Rucio events.</li>
<li><a href="#traces"><strong>File/Dataset Access Monitoring</strong></a>: Using traces to monitor client interactions.</li>
<li><a href="#rucio-database-dump"><strong>Database Dump and Visualization</strong></a>: Extracting database-level metrics for visualization.</li>
<li><a href="#rucio-monitoring-probes"><strong>Probes</strong></a>: Automated checks and using Nagios or Prometheus Pushgateway.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-monitoring">Internal Monitoring<a href="#internal-monitoring" class="hash-link" aria-label="Direct link to Internal Monitoring" title="Direct link to Internal Monitoring">​</a></h2>
<p>This is to monitor the internals of Rucio servers and daemons, e.g., submission
rate of the conveyor, state of conveyor queues, reaper deletion rate, server
response times, server active session, etc. Metrics are typically categorized as:</p>
<ul>
<li>Counters – measure the number of events (e.g., requests processed).</li>
<li>Timers/Histograms – measure durations of operations (e.g., rule evaluation time, transfer submission time).</li>
<li>Gauges – measure values that can go up and down (e.g., number of active sessions, queue sizes).</li>
</ul>
<!-- -->
<p>There are two options:</p>
<ol>
<li>
<p>Graphite</p>
<p>Metrics are pushed to a Graphite server.</p>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[monitor]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># specify the hostname for carbon server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">carbon_server = &lt;hostname&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">carbon_port = 8125</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">user_scope = rucio</span><br></span></code></pre></div></div>
</li>
<li>
<p>Prometheus</p>
<p>Metrics can be scraped by Prometheus or optionally pushed to Prometheus Pushgateway for short-lived processes. Prometheus also supports multiprocess-safe metrics for deployments using multiple threads or Apache MPM subprocesses. Exposed over an HTTP endpoint for scraping <code>/metrics</code>. Multiprocess-safe metrics are supported using the PROMETHEUS_MULTIPROC_DIR environment variable.</p>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[monitor]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Enable Prometheus metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enable_metrics = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Port for Prometheus HTTP server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metrics_port = 8080</span><br></span></code></pre></div></div>
</li>
</ol>
<p>The used metrics can be found in following links (code search)</p>
<ul>
<li><a href="https://github.com/search?q=repo%3Arucio%2Frucio+Metrics.Counter&amp;type=code" target="_blank" rel="noopener noreferrer">Counter</a></li>
<li><a href="https://github.com/search?q=repo%3Arucio%2Frucio+Metrics.gauge&amp;type=code" target="_blank" rel="noopener noreferrer">Gauge</a></li>
<li><a href="https://github.com/search?q=repo%3Arucio%2Frucio+Metrics.timer&amp;type=code" target="_blank" rel="noopener noreferrer">Timer</a></li>
</ul>
<p><a href="https://github.com/rucio/monitoring-templates/blob/main/prometheus-monitoring/Dashboards/Rucio-Internal.json" target="_blank" rel="noopener noreferrer">Grafana Dashboard JSON</a> for Prometheus is given here.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transfers-deletion-and-other-monitoring">Transfers, Deletion and Other Monitoring<a href="#transfers-deletion-and-other-monitoring" class="hash-link" aria-label="Direct link to Transfers, Deletion and Other Monitoring" title="Direct link to Transfers, Deletion and Other Monitoring">​</a></h2>
<p>Rucio generates a large volume of operational events for activities such as: transfers, deletions, rule evaluations, replication tasks, etc., originating from daemons like conveyor, reaper, judge, and others.</p>
<p>These events are collected and delivered by the Hermes daemon, which can forward them to message queues or storage backends for further processing, analysis, and storage. According to your storage backend you can use visualization software like Grafana/Kibana.</p>
<!-- -->
<p>Different options are shown in figure and described below.</p>
<ol>
<li>
<p>Queue-Based Pipelines</p>
<p>Hermes publishes events to a queue or topic in message queue (like ActiveMQ) via STOMP. Multiple consumers can process events independently, which enables real-time, decoupled processing pipelines. These events from ActiveMQ can be consumed by ETL pipelines. These Pipelines allow aggregation, transformation, enrichment, and forwarding to different storage backends of your choice.</p>
<p>Example pipeline : ActiveMQ -&gt; Logstash -&gt; OpenSearch</p>
<p>Config for this is described below.</p>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[hermes]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># List of services Hermes should send messages to.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">services_list = activemq</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Toggle query behavior:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># True  -&gt; fetch bulk messages for each service individually</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># False -&gt; fetch bulk messages across all services together</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query_by_service = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Bulk retrieval size for each call to the database</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bulk = 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[messaging-hermes]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ActiveMQ options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># List of broker hostnames or DNS aliases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">brokers = amq1.example.com, amq2.example.com</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Destination queue or topic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">destination = /queue/rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Use SSL for ActiveMQ connection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use_ssl = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># SSL certificate files (if using SSL)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssl_cert_file = /etc/rucio/certs/hermes-client-cert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssl_key_file = /etc/rucio/certs/hermes-client-key.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Virtual host, optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">broker_virtual_host = /</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Non-SSL port (used if use_ssl=False)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nonssl_port = 61613</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># SSL port (used if use_ssl=True)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port = 61614</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ActiveMQ username/password (used if use_ssl=False)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">username =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">password =</span><br></span></code></pre></div></div>
</li>
<li>
<p>Direct Delivery</p>
<p>These options send events directly to storage or alerting systems, bypassing queues.
Hermes can write events straight to Elasticsearch, OpenSearch, or InfluxDB. In addition can also deliver events via email which supports custom SMTP servers, credentials, and SSL/TLS.</p>
<p>Configuration option for each type is described below.</p>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># rucio.cfg</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># =========================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Hermes Daemon Configuration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># =========================</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[hermes]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># List of services Hermes should send messages to.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Supported values: influx, elastic, email, activemq</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">services_list = elastic, influx, email, activemq</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Toggle query behavior:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># True  -&gt; fetch bulk messages for each service individually</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># False -&gt; fetch bulk messages across all services together</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query_by_service = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Bulk retrieval size for each call to the database</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bulk = 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># InfluxDB endpoint for sending aggregated metrics</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">influxdb_endpoint = https://influxdb-host:8086/api/v2/write?org=my-org&amp;bucket=my-bucket&amp;precision=ns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Token for authenticating to InfluxDB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">influxdb_token = my-secret-influxdb-token</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Elasticsearch endpoint for sending events</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elastic_endpoint = https://Elasticsearch-host:9200/rucio-eic-event/_bulk</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Optional credentials if Elasticsearch is secured</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elastic_username = admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elastic_password = password</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Email sending options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">send_email = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">email_from = rucio@cern.ch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_host = smtp.cern.ch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_port = 587</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_username = my-smtp-user</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_password = my-smtp-pass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_usessl = False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_usetls = True</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_certfile =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">smtp_keyfile =</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-types">Event Types<a href="#event-types" class="hash-link" aria-label="Direct link to Event Types" title="Direct link to Event Types">​</a></h3>
<p>Different event types are created</p>
<ul>
<li>Transfers: <code>transfer-submitted</code>, <code>transfer-submission_failed</code>, <code>transfer-queued</code>, <code>transfer-failed</code>, <code>transfer-done</code></li>
<li>Deletions: <code>deletion-done</code>, <code>deletion-not-found</code>, <code>deletion-failed</code></li>
<li>Rules: <code>RULE_OK</code>, and <code>RULE_PROGRESS</code></li>
<li>Locks: <code>DATASETLOCK_OK</code></li>
<li>DIDs: <code>CREATE_CNT</code> and <code>CREATE_DTS</code></li>
<li>Replicas: <code>INCOMPLETE</code> and <code>ERASE</code></li>
</ul>
<p>The structure of messages table which is extracted by Hermes is:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;UUID4&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;services&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;service_name&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;event_type&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;event_type&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;created_at&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;yyyy-MM-dd HH:mm:ss.SSSSSS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token property">&quot;payload_nolimit&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>where:</p>
<ul>
<li><code>id</code>: UUID string</li>
<li><code>event_type</code>: string describing the event_type listed before</li>
<li><code>payload</code>: small JSON object (max 4000 chars), structure varies by event type</li>
<li><code>payload_nolimit</code>: optional large JSON object. Only if payload larger than 4000 characters</li>
<li><code>services</code>: string identifying the service. (elastic, activemq, influx)</li>
<li><code>created_at</code>: When the message was created. ISO 8601 timestamps</li>
</ul>
<p>To quickly inspect the payloads of these event types:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> created_at</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> payload</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> messages</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> event_type </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;event_type&gt;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> created_at </span><span class="token keyword" style="font-style:italic">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre></div></div>
<p>replace <code>event_type</code> with actual name that you want to inspect. We can also check <code>messages_history</code> table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="format-of-messages-delivered-by-hermes">Format of Messages Delivered by Hermes<a href="#format-of-messages-delivered-by-hermes" class="hash-link" aria-label="Direct link to Format of Messages Delivered by Hermes" title="Direct link to Format of Messages Delivered by Hermes">​</a></h3>
<p>The final format of the message is determined by the destination service, as Hermes transforms the raw database message into the required wire protocol for external systems.</p>
<ul>
<li>
<p>ActiveMQ (STOMP Message): The body is a streamlined JSON object containing only <code>event_type</code>, <code>payload</code>, and <code>created_at</code>. The message uses STOMP headers to set the event_type and flag the message as persistent.</p>
</li>
<li>
<p>Elasticsearch / OpenSearch (Bulk API): Hermes sends the raw database JSON message (including <code>id</code> and <code>services</code>) as a document using Bulk API format (via a POST request).</p>
</li>
<li>
<p>InfluxDB (Line Protocol): Hermes performs on-the-fly aggregation of transfers and deletions, counting successes/failures and bytes. It does not send the raw event JSON. The final format is the InfluxDB Line Protocol, which consists of a single text line combining the measurement, tags (e.g., RSE, activity), fields (e.g., <code>nb_done=10</code>), and a timestamp.</p>
</li>
</ul>
<p>Example Grafana dashboard for transfer is provided <a href="https://github.com/rucio/monitoring-templates/blob/main/message-monitoring/Dashboards/Rucio-Transfer.json" target="_blank" rel="noopener noreferrer">here</a></p>
<blockquote>
<p><strong>Note</strong>: Please make changes to the dashboard according to your setup and needs.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="traces">Traces<a href="#traces" class="hash-link" aria-label="Direct link to Traces" title="Direct link to Traces">​</a></h2>
<p>Rucio clients can send trace events on every file upload or download. These are posted to the <code>/traces</code> endpoint and forwarded to a message broker such as ActiveMQ via STOMP. Messages are consumed by Rucio’s Kronos daemon or by external consumers.</p>
<p>This is shown in figure below. Schemas of the traces can be found in <a href="https://github.com/rucio/rucio/blob/master/lib/rucio/core/trace.py" target="_blank" rel="noopener noreferrer"><code>trace.py</code></a> which can be used for dashboards.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-database-dump">Rucio database dump<a href="#rucio-database-dump" class="hash-link" aria-label="Direct link to Rucio database dump" title="Direct link to Rucio database dump">​</a></h2>
<p>Database-level monitoring extracts different information directly from the Rucio database. This includes insights such as RSE usage statistics, account quotas, and other metadata relevant to experiments. These data are periodically queried and exported to external storage backends for visualization and long-term monitoring.</p>
<p>Some example Logstash pipeline definitions are given <a href="https://github.com/rucio/monitoring-templates/blob/main/logstash-monitoring/Pipelines/pipelines.yml" target="_blank" rel="noopener noreferrer">here</a>. These example pipelines use the Logstash JDBC input plugin to connect to the Rucio PostgreSQL database, execute SQL queries, and extract structured data periodically. The retrieved records are then sent to Elasticsearch but can be changed to other storage backends such as OpenSearch. The following diagram shows the high-level flow for database-level monitoring using Logstash.</p>
<blockquote>
<p><strong>Note</strong> : While this example uses Logstash, you can use other data collector options like <a href="https://www.fluentd.org/" target="_blank" rel="noopener noreferrer">fluentd</a> with <a href="https://github.com/fluent/fluent-plugin-sql" target="_blank" rel="noopener noreferrer">plugin</a> depending on your requirements.</p>
</blockquote>
<!-- -->
<p>A typical Logstash configuration consists of three sections — input, filter, and output. For example, the input section defines the PostgreSQL connection and SQL query to fetch data:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">input {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   jdbc {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      jdbc_connection_string =&gt; &quot;jdbc:postgresql://host:5432/&lt;dbname&gt;&quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      jdbc_user =&gt; &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      jdbc_password =&gt; &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      jdbc_driver_library =&gt; &quot;/usr/share/logstash/java/postgresql-&lt;version&gt;.jar&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      jdbc_driver_class =&gt; &quot;org.postgresql.Driver&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      statement =&gt; &quot;SELECT rses.rse, rse_usage.source, rse_usage.used, rse_usage.free, rse_usage.files FROM rse_usage INNER JOIN rses ON rse_usage.rse_id=rses.id WHERE rse_usage.files IS NOT NULL AND rse_usage.files!=0;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      schedule =&gt; &quot;0 0 * * *&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">filter {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # Placeholder for transformations or enrichments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # Examples:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # - Add computed fields</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # - Rename fields</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # - Convert units (e.g., bytes to GB)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   # - Drop unwanted fields</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  elasticsearch {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hosts =&gt; [&quot;http://elasticsearch:9200&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    action =&gt; &quot;index&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    index =&gt; &quot;rucio_rse&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user =&gt; &quot;elastic&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    password =&gt; &quot;password&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Few points:</p>
<ul>
<li><code>jdbc_driver_library</code>: Can be downloaded from <a href="https://jdbc.postgresql.org/" target="_blank" rel="noopener noreferrer">jdbc.postgresql.org</a>, choose the version that you want to use and enable that in Logstash.</li>
<li><code>schedule</code>: Defines how often the query runs (Cron-like syntax).</li>
<li><code>output</code>: Defines where the extracted data are delivered. In most deployments, these are indexed into OpenSearch or Elasticsearch for analytics dashboards in Grafana or Kibana.</li>
<li><code>filter</code>: This is optional. It helps in preprocessing your data before indexing</li>
</ul>
<p><a href="https://github.com/rucio/monitoring-templates/blob/main/logstash-monitoring/Dashboards/Rucio-Storage.json" target="_blank" rel="noopener noreferrer">Grafana dashboard</a> example for RSE given.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-monitoring-probes">Rucio Monitoring Probes<a href="#rucio-monitoring-probes" class="hash-link" aria-label="Direct link to Rucio Monitoring Probes" title="Direct link to Rucio Monitoring Probes">​</a></h2>
<p>Rucio provides a collection of <strong>monitoring probes</strong> that check the different status metrics of the Rucio.
The list of probes is available <a href="https://github.com/rucio/probes/tree/master/common" target="_blank" rel="noopener noreferrer">here</a> probes shared across experiments. Also can create experiment-specific probes for custom monitoring like <a href="https://github.com/rucio/probes/tree/master/atlas" target="_blank" rel="noopener noreferrer">ATLAS</a> and <a href="https://github.com/rucio/probes/tree/master/cms" target="_blank" rel="noopener noreferrer">CMS</a>.</p>
<p>Rucio provides a prebuilt container on <a href="https://hub.docker.com/r/rucio/probes" target="_blank" rel="noopener noreferrer">Docker Hub</a> that includes:</p>
<ul>
<li>All dependencies for running the probes.</li>
<li>A lightweight <strong>Jobber</strong> daemon for scheduling probe execution.</li>
<li>The full Rucio probe repository. Custom probes can be added by introducing them to your own Rucio instance.</li>
</ul>
<p>The container can push results either to a <strong>Prometheus Pushgateway</strong> or export data for <strong>Nagios</strong> alerting.</p>
<!-- -->
<p>Probe Execution Workflow is:</p>
<ul>
<li><strong>Probes</strong> are Python scripts under <code>rucio/probes/</code>.</li>
<li><strong>Jobber</strong> acts as a cron-like scheduler inside the container.</li>
<li><strong>Output options:</strong>
<ul>
<li><strong>Prometheus Pushgateway:</strong> for time-series metrics. Alerts can be added with <a href="https://prometheus.io/docs/alerting/latest/alertmanager/" target="_blank" rel="noopener noreferrer">Prometheus</a> and <a href="https://grafana.com/docs/grafana/latest/alerting/set-up/configure-alertmanager/" target="_blank" rel="noopener noreferrer">Grafana</a> alert management.</li>
<li><strong>Nagios:</strong> Used mainly as a cron-style runner where exit codes trigger Nagios alerts, while probe metrics are sent to Prometheus.</li>
</ul>
</li>
</ul>
<p>To make use of Prometheus functionality, make sure your <code>rucio.cfg</code> inside the container with the probes has the extra sections and options:</p>
<div class="language-cfg codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cfg codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[monitor]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prometheus_servers = &quot;https://prometheuserver:port&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prometheus_prefix = &quot;&quot; # default empty</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prometheus_labels = &quot;&quot; # default empty</span><br></span></code></pre></div></div>
<p>For adding cron-like scheduling for each probe in jobber, make sure you have added needed config in <a href="https://github.com/rucio/containers/blob/master/probes/dot-jobber" target="_blank" rel="noopener noreferrer">dot-jobber</a>. An example config is given below, running the probes <code>check_expired_dids</code> and <code>check_stuck_rules</code>. This config assumes your probes are in the top level directory of the container.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">jobs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CheckExpiredDIDs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./check_expired_dids</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*/5 * * * *&#x27;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># every 5 minutes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">onError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Continue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CheckStuckRules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">cmd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ./check_stuck_rules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">time</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;0 * * * *&#x27;</span><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># hourly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">onError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Continue</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/operator/monitoring.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-02-11T09:21:06.000Z" itemprop="dateModified">Feb 11, 2026</time></b> by <b>Martin Barisits</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/operator/k8s_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">A Kubernetes tutorial</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/operator/multi_vo_rucio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi-VO Rucio</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#internal-monitoring" class="table-of-contents__link toc-highlight">Internal Monitoring</a></li><li><a href="#transfers-deletion-and-other-monitoring" class="table-of-contents__link toc-highlight">Transfers, Deletion and Other Monitoring</a><ul><li><a href="#event-types" class="table-of-contents__link toc-highlight">Event Types</a></li><li><a href="#format-of-messages-delivered-by-hermes" class="table-of-contents__link toc-highlight">Format of Messages Delivered by Hermes</a></li></ul></li><li><a href="#traces" class="table-of-contents__link toc-highlight">Traces</a></li><li><a href="#rucio-database-dump" class="table-of-contents__link toc-highlight">Rucio database dump</a></li><li><a href="#rucio-monitoring-probes" class="table-of-contents__link toc-highlight">Rucio Monitoring Probes</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
</body>
</html>