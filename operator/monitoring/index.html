<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-operator/monitoring" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Monitoring | Rucio Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/operator/monitoring"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Monitoring | Rucio Documentation"><meta data-rh="true" name="description" content="There are three different monitoring components:"><meta data-rh="true" property="og:description" content="There are three different monitoring components:"><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/operator/monitoring"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/monitoring" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/monitoring" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Monitoring","item":"https://rucio.github.io/documentation/operator/monitoring"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">

<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/documentation/assets/css/styles.6eee9218.css">
<script src="/documentation/assets/js/runtime~main.d647a175.js" defer="defer"></script>
<script src="/documentation/assets/js/main.434efbf9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_black.svg"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a href="/documentation/html/client_api/accountclient.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Python Client API</a><a class="navbar__item navbar__link" href="/documentation/bin/rucio">Command Line Client</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/started/before_you_get_started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/user/setting_up_the_rucio_client">User</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentation/operator/setting_up_demo">Operator</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/setting_up_demo">Setting up a Rucio demo environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/kubernetes">Setting up Rucio on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_server">Installing Rucio Server</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/documentation/operator/policy_packages/policy_packages_overview">Policy Packages</a><button aria-label="Expand sidebar category &#x27;Policy Packages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_daemons">Installing Rucio Daemons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/administration">Administration Tricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration_parameters">Configuration parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/database">Database Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/did_meta">DID Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/k8s_guide">A Kubernetes tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/operator/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/multi_vo_rucio">Multi-VO Rucio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/notifications">Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/qos_rse_config">QoS RSE Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/s3_rse_config">S3 Storage Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/suspicious-replica-recoverer">Suspicious Replica Recoverer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/operator_transfers/configure-rucio-fts3-plugins">Transfers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/bin/rucio-abacus-account">Executables</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/developer/dependency_management">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/project_organisation">About Us</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operator</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Monitoring</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Monitoring</h1></header><p>There are three different monitoring components:</p>
<ul>
<li>Rucio internal monitoring using Graphite/Grafana</li>
<li>Transfer monitoring using the messages sent by Hermes</li>
<li>File/Dataset Access monitoring using the traces</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="internal-monitoring">Internal Monitoring<a href="#internal-monitoring" class="hash-link" aria-label="Direct link to Internal Monitoring" title="Direct link to Internal Monitoring">​</a></h2>
<p>This is to monitor the internals of Rucio servers and daemons, e.g., submission
rate of the conveyor, state of conveyor queues, reaper deletion rate, server
response times, server active session, etc. We use Graphite<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup> for this. It&#x27;s
easy to setup and then you have to point your Rucio instance to the Graphite
server using the &quot;carbon_server&quot; options in the &quot;monitor&quot; section in
etc/rucio.cfg.</p>
<p>The different Rucio components will then send metrics using those &quot;record&quot;
functions you will find all over the code. Graphite has a built-in web interface
to show graphs but more comfortable to use is the Grafana<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup> tool.</p>
<p>The internal monitoring functions are defined in core/monitor.py, it includes:</p>
<ol>
<li>
<p>record_counter. This is to send the StatsD counter metrics. Counters are the
most basic and default type. They are treated as a count of a type of event per
second, and are, in Graphite, typically averaged over one minute. That is, when
looking at a graph, you are usually seeing the average number of events per
second during a one-minute period.</p>
</li>
<li>
<p>record_timer. Timers are meant to track how long something took. They are an
invaluable tool for tracking application performance. The statsd server collects
all timers under the stats.timers prefix, and will calculate the lower bound,
mean, 90th percentile, upper bound, and count of each timer for each period (by
the time you see it in Graphite, that’s usually per minute).</p>
</li>
<li>
<p>record_timer_block. This is the same to record_timer, just for simple using,
to calculate timer of a certain code block.</p>
</li>
<li>
<p>record_gauge. Gauges are a constant data type. They are not subject to
averaging, and they don’t change unless you change them. That is, once you set a
gauge value, it will be a flat line on the graph until you change it again.</p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-the-rucio-internal-monitoring-dashboard">Set up the Rucio internal monitoring dashboard<a href="#set-up-the-rucio-internal-monitoring-dashboard" class="hash-link" aria-label="Direct link to Set up the Rucio internal monitoring dashboard" title="Direct link to Set up the Rucio internal monitoring dashboard">​</a></h3>
<p>Set up a rucio server for development</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/rucio/rucio.git</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker-compose --file etc/docker/dev/docker-compose.yml up -d</span><br></span></code></pre></div></div>
<p>The command will fire up various containers such as <code>dev-rucio-1</code>, <code>dev-graphite-1</code>, and
<code>dev-activemq-1</code>. <code>dev-graphite-1</code> is the one collecting internal
metrics from Rucio. The configurations of Rucio internal metrics sender are
defined under the [monitor] section of rucio.cfg. Change the carbon_server and
carbon_port according to your setting</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[monitor]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">carbon_server = graphite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">carbon_port = 8125</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">user_scope = docker</span><br></span></code></pre></div></div>
<p>The Graphite builtin web page is on port 80 of the host. To use Grafana, setup
Grafana and enable the graphite data source</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull grafana/grafana</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d --name=grafana -p 3000:3000 grafana/grafana</span><br></span></code></pre></div></div>
<p>The Grafana web-portal is on port 3000 of the host. Add one data source of the
type Graphite, choose access method to &quot;Browser&quot; and set URL to <a href="http://ip:80" target="_blank" rel="noopener noreferrer">http://ip:80</a>,
where ip is the address of the server hosting the Graphite container
<code>dev-graphite-1</code>.</p>
<p>A set of pre-defined Grafana Rucio internal plots is provided
<a href="https://github.com/rucio/rucio/blob/master/tools/monitoring/visualization/rucio-internal.json" target="_blank" rel="noopener noreferrer">here</a>.
Users could import them directly into Grafana.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-list-of-rucio-internal-metrics">The list of Rucio internal metrics<a href="#the-list-of-rucio-internal-metrics" class="hash-link" aria-label="Direct link to The list of Rucio internal metrics" title="Direct link to The list of Rucio internal metrics">​</a></h3>
<ol>
<li>Core</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">credential.signswift, credential.signs3 (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trace.nongrid_trace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">core.request.* (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">core.request.archive_request.* (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule.add_rule, rule.add_rule.*, rule.delete_rule, rule.evaluate_did_detach, rule.evaluate_did_attach.(timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trace.trace (counter)</span><br></span></code></pre></div></div>
<ol start="2">
<li>Transfertool</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.delegate_proxy.success.*, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  transfertool.fts3.delegate_proxy.fail.* (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.submit_transfer.[externalhost] (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].submission.success/failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].cancel.success/failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].update_priority.success/failure  (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].query.success/failure  (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].whoami.failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].Version.failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].query_details.failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].bulk_query.failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3.[externalhost].query_latest.failure (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transfertool.fts3myproxy.[externalhost].submission.success/failure (counter)</span><br></span></code></pre></div></div>
<ol start="3">
<li>Judge</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rule.judge.exceptions.*</span><br></span></code></pre></div></div>
<ol start="4">
<li>Transmogrified</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">transmogrifier.addnewrule.errortype.* (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transmogrifier.addnewrule.activity.* (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transmogrifier.did.*.processed (counter)</span><br></span></code></pre></div></div>
<ol start="5">
<li>Tracer</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.tracer.kronos.* (counter)</span><br></span></code></pre></div></div>
<ol start="6">
<li>Reaper</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">reaper.list_unlocked_replicas, reaper.delete_replicas (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reaper.deletion.being_deleted, reaper.deletion.done (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.reaper.delete.[scheme].[rse] (timer)</span><br></span></code></pre></div></div>
<ol start="7">
<li>Undertaker</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">undertaker.delete_dids, undertaker.delete_dids.exceptions.LocksDetected (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">undertaker.rules, undertaker.parent_content, undertaker.content, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  undertaker.dids (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">undertaker.content.rowcount (counter)</span><br></span></code></pre></div></div>
<ol start="8">
<li>Replicarecover</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">replica.recoverer.exceptions.* (counter)</span><br></span></code></pre></div></div>
<ol start="9">
<li>Hermes</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.hermes.reconnect.* (counter)</span><br></span></code></pre></div></div>
<ol start="10">
<li>Conveyor</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.[submitter].submit_bulk_transfer.per_file, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  daemons.conveyor.[submitter].submit_bulk_transfer.files (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.[submitter].submit_bulk_transfer (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.finisher.000-get_next (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.finisher.handle_requests (timer &amp; counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.common.update_request_state.request-requeue_and_archive (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.poller.000-get_next (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.poller.bulk_query_transfers (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.poller.transfer_lost (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.poller.query_transfer_exception (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.poller.update_request_state.* (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.receiver.error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.receiver.message_all</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.receiver.message_rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.receiver.update_request_state.*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.receiver.set_transfer_update_time</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.messaging.fts3.reconnect.*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.stager.get_stagein_transfers.per_transfer, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  daemons.conveyor.stager.get_stagein_transfers.transfer (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.stager.get_stagein_transfers (count)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.stager.bulk_group_transfer (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.submitter.get_stagein_transfers.per_transfer, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  daemons.conveyor.submitter.get_stagein_transfers.transfer (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.submitter.get_stagein_transfers (count)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.submitter.bulk_group_transfer (timer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.throttler.set_rse_transfer_limits.\</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [rse].max_transfers/transfers/waitings (gauge)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.throttler.delete_rse_transfer_limits.[rse] (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.throttler.delete_rse_transfer_limits.[activity].[rse] (counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.throttler.set_rse_transfer_limits.[activity].[rse] (gauge)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">daemons.conveyor.throttler.release_waiting_requests.[activity].[rse].[account] (counter)</span><br></span></code></pre></div></div>
<ol start="11">
<li>Necromancer</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">necromancer.badfiles.lostfile, necromancer.badfiles.recovering (counter)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transfer-monitoring">Transfer monitoring<a href="#transfer-monitoring" class="hash-link" aria-label="Direct link to Transfer monitoring" title="Direct link to Transfer monitoring">​</a></h2>
<p>If a transfer is submitted, queued, waiting, done or failed messages are sent to
ActiveMQ via Hermes and are also archived in the messages_history table. Same is
true for deletions. In the case of ATLAS we have a dedicated monitoring
infrastructure that reads the messages from
<a href="https://activemq.apache.org" target="_blank" rel="noopener noreferrer">ActiveMQ</a>, aggregates them and then writes the
aggregated data into ElasticSearch/InfluxDB from where it then can be visualised
using Kibana/Grafana.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-up-the-rucio-internal-monitoring-dashboard-1">Set up the Rucio internal monitoring dashboard<a href="#set-up-the-rucio-internal-monitoring-dashboard-1" class="hash-link" aria-label="Direct link to Set up the Rucio internal monitoring dashboard" title="Direct link to Set up the Rucio internal monitoring dashboard">​</a></h3>
<ol>
<li>Configure Rucio</li>
</ol>
<p>Rucio need to be configured to enable the message broker. In Rucio, message are
sent by the Hermes daemon. Settings are defined in therucio.cfg under the
[messaging-hermes] section</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[messaging-hermes]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">username =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">password =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port = 61613</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">nonssl_port = 61613</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use_ssl = False</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssl_key_file = /etc/grid-security/hostkey.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ssl_cert_file = /etc/grid-security/hostcert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">destination = /topic/rucio.events</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">brokers = activemq</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">voname = atlas</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">email_from =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">email_test =</span><br></span></code></pre></div></div>
<p>The default settings are listed above. If ssl is not used, set use_ssl to False
and define username and password. They should be &quot;admin&quot;, &quot;admin&quot; for the
default activemq settings. If you are not using the containers created by the
docker-compose command, change the brokers and port to the server hosting the
message queue.</p>
<ol start="2">
<li>Setup Elasticsearch and Kibana</li>
</ol>
<p>Next is to setup and configure Elasticsearch and Kibana for storing and
visualising the messages. This is an example of creating them in containers</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p 9200:9200 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p 9300:9300 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e &quot;discovery.type=single-node&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --name elasticsearch \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  docker.elastic.co/elasticsearch/elasticsearch:7.8.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -d \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --link elasticsearch \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -p 5601:5601 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --name kibana \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  docker.elastic.co/kibana/kibana:7.8.1</span><br></span></code></pre></div></div>
<ol start="3">
<li>Import Elasticsearch indices</li>
</ol>
<p>Before transferring messages from the message queue to Elasticsearch, indices
need to be defined in Elasticsearch. This is a list of the message formats of
Rucio.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transfer-events">Transfer events<a href="#transfer-events" class="hash-link" aria-label="Direct link to Transfer events" title="Direct link to Transfer events">​</a></h3>
<div class="language-jsi codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-jsi codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  created_at: when the message was created (yyyy-MM-dd HH:mm:ss.SSSSSS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  event_type: type of this event (transfer-submitted, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transfer-submittion_failed, transfer-queued, transfer-failed, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transfer-done)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  payload: {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    account: account submitting the request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    activity: activity of the request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes: size of the transferred file (byte)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    checksum-adler: checksum using adler algorithm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    checksum-md5: checksum using md5 algorithm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    created_at: Time when the message was created (yyyy-MM-dd HH:mm:ss.SSSSSS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dst-rse: destination rse</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dst-type: type of destination rse (disk, tape)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dst-url: destination url of the transferred file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    duration: duration of the transfer (second)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    event_type: type of this event (transfer-submitted, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      transfer-submittion_failed, transfer-queued, \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      transfer-failed, transfer-done)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    file-size: same as bytes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    guid: guid of the transfer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name: name of transferred file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    previous-request-id: id of previous request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protocol: transfer protocol</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reason: reason of the failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    request-id: id of this request</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope: scope of the transferred data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    src-rse: source rse</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    src-type: type of source rse (disk, tape)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    src-url: source file url</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    started_at: start time of the transfer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    submitted_at: submission time of the transfer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tool-id: id of the transfer tool in rucio (rucio-conveyor)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transfer-endpoint: endpoint holder of the transfer (fts)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transfer-id: uuid of this transfer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transfer-link: link of this transfer (in form of fts url)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    transferred_at: done time of this transfer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deletion-events">Deletion events<a href="#deletion-events" class="hash-link" aria-label="Direct link to Deletion events" title="Direct link to Deletion events">​</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  created_at</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> when the message was created (yyyy-MM-dd HH</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">mm</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain">ss.SSSSSS)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  event_type</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> type of this event (deletion-done</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">deletion-failed)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  payload</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    scope</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> scope of the deleted replica</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> name of the deleted replica</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rse</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> rse holding the deleted replica</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    file-size</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> size of the file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> size of the file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> url of the file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    duration</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> duration of the deletion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    protocol</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> prococol used in the deletion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    reason</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> reason of the failure</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>The formats of them are defined in <a href="https://github.com/rucio/rucio/blob/master/tools/monitoring/rucio-transfer.json" target="_blank" rel="noopener noreferrer"><code>rucio-transfer.json</code></a>
and <a href="https://github.com/rucio/rucio/blob/master/tools/monitoring/rucio-deletion.json" target="_blank" rel="noopener noreferrer"><code>rucio_deletion.json</code></a>
which could be imported into Kibana.</p>
<p>Rucio also sends messages when adding/deleting rules/DIDs and for file/dataset
access. So the monitoring is not limited to data transferring.</p>
<ol start="4">
<li>Transmit messages from message queue to Elastisearch</li>
</ol>
<p>This could be done via Logstash. Please refer to <a href="https://www.elastic.co/blog/integrating-jms-with-elasticsearch-service-using-logstash" target="_blank" rel="noopener noreferrer">Elastic&#x27;s documentation.</a>.</p>
<p>Alternatively you could use a simple Python script such as <a href="https://github.com/rucio/rucio/blob/master/tools/monitoring/extract.py" target="_blank" rel="noopener noreferrer"><code>extract.py</code></a> for
this after installing the required tools</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip install --upgrade pip</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pip install elasticsearch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://files.pythonhosted.org/packages/52/7e/22ca617f61e0d5904e06c1ebd5d453adf30099526c0b64dca8d74fff0cad/stomp.py-4.1.22.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar -zxvf stomp.py-4.1.22.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd stomp.py-4.1.22</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">python setup.py install</span><br></span></code></pre></div></div>
<p>Change the configurations (message broker and elastisearch cluster) in
exporter.py and start it. It could be made as a systemd service for convenience.</p>
<ol start="5">
<li>Create Kibana dashboards based on the imported messages.</li>
</ol>
<p>A set of pre-defined dashboards can be found
<a href="https://github.com/rucio/rucio/tree/master/tools/monitoring/visualization" target="_blank" rel="noopener noreferrer">here</a> in
json format which could be imported to Kibana directly. But you may have to
resolve different UUIDs in Kibana.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="access-monitoring">Access monitoring<a href="#access-monitoring" class="hash-link" aria-label="Direct link to Access monitoring" title="Direct link to Access monitoring">​</a></h2>
<p>The traces are sent by the pilots or the rucio clients whenever a file is
downloaded/uploaded. This is similar with the data transferring monitoring.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-database-dumping">Rucio database dumping<a href="#rucio-database-dumping" class="hash-link" aria-label="Direct link to Rucio database dumping" title="Direct link to Rucio database dumping">​</a></h2>
<p>Besides the internal, data transferring/deletion/accessing monitoring, it&#x27;s also
possible to dump the Rucio internal database directly to Elasticsearch. Then
information like data location, accounting, RSE summary could be visualised
using Kibana or Grafana.</p>
<p>We provide several examples of dumping Rucio DB tables using the logstash jdbc
plugin and making plots based on them.</p>
<p>To start a logstash pipeline, run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">logstash -f rse.conf</span><br></span></code></pre></div></div>
<p>Where the rse.conf contains</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">input </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  jdbc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jdbc_connection_string =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jdbc_user =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jdbc_password =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jdbc_driver_library =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/usr/share/logstash/java/postgresql-42.2.6.jar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    jdbc_driver_class =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;org.postgresql.Driver&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    statement =&gt; &quot;SELECT rses.rse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rse_usage.source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rse_usage.used</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rse_usage.free</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rse_usage.files FROM rse_usage INNER JOIN rses ON \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rse_usage.rse_id=rses.id WHERE rse_usage.files IS NOT NULL AND \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rse_usage.files!=</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">output </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  elasticsearch </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hosts =&gt; </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    action =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;index&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    index =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;rucio_rse&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    user =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    password =&gt; </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre></div></div>
<p>The rse pipeline dumps data like how large is the total space, how large is the
used space, how many files are saved on each RSE etc. Please fill in the jdbc
connection details and Elastisearch connection details in the config file.</p>
<p>More pipeline definitions can be found <a href="https://github.com/rucio/rucio/tree/master/tools/monitoring/logstash-pipeline" target="_blank" rel="noopener noreferrer">here</a>,
and users could design their own DB queries for their specific monitoring
needs. Also users could directly import the Elasticsearch indices and Kibana
dashboard from <a href="https://github.com/rucio/rucio/tree/master/tools/monitoring/visualization/db_dump" target="_blank" rel="noopener noreferrer">these</a>.
json files.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="footnotes">Footnotes<a href="#footnotes" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a href="#footnote-label" class="hash-link" aria-label="Direct link to Footnotes" title="Direct link to Footnotes">​</a></h2>
<ol>
<li id="user-content-fn-1">
<p>[<a href="https://graphiteapp.org/" target="_blank" rel="noopener noreferrer">https://graphiteapp.org/</a>] <a href="#user-content-fnref-1" data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>[<a href="https://grafana.com/" target="_blank" rel="noopener noreferrer">https://grafana.com/</a>] <a href="#user-content-fnref-2" data-footnote-backref="" aria-label="Back to reference 2" class="data-footnote-backref">↩</a></p>
</li>
</ol>
</section></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/operator/monitoring.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-26T07:48:24.000Z" itemprop="dateModified">Jun 26, 2025</time></b> by <b>Dimitris Xenakis</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/operator/k8s_guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">A Kubernetes tutorial</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/operator/multi_vo_rucio"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multi-VO Rucio</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#internal-monitoring" class="table-of-contents__link toc-highlight">Internal Monitoring</a><ul><li><a href="#set-up-the-rucio-internal-monitoring-dashboard" class="table-of-contents__link toc-highlight">Set up the Rucio internal monitoring dashboard</a></li><li><a href="#the-list-of-rucio-internal-metrics" class="table-of-contents__link toc-highlight">The list of Rucio internal metrics</a></li></ul></li><li><a href="#transfer-monitoring" class="table-of-contents__link toc-highlight">Transfer monitoring</a><ul><li><a href="#set-up-the-rucio-internal-monitoring-dashboard-1" class="table-of-contents__link toc-highlight">Set up the Rucio internal monitoring dashboard</a></li><li><a href="#transfer-events" class="table-of-contents__link toc-highlight">Transfer events</a></li><li><a href="#deletion-events" class="table-of-contents__link toc-highlight">Deletion events</a></li></ul></li><li><a href="#access-monitoring" class="table-of-contents__link toc-highlight">Access monitoring</a></li><li><a href="#rucio-database-dumping" class="table-of-contents__link toc-highlight">Rucio database dumping</a></li><li><a href="#footnotes" class="table-of-contents__link toc-highlight">Footnotes</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
</body>
</html>