<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-operator/policy_packages" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Policy Packages | Rucio Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/operator/policy_packages"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Policy Packages | Rucio Documentation"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/operator/policy_packages"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/policy_packages" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/policy_packages" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">
<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/documentation/assets/css/styles.ba9ba7c4.css">
<script src="/documentation/assets/js/runtime~main.a309d11f.js" defer="defer"></script>
<script src="/documentation/assets/js/main.bd7d3696.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_black.svg"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a href="/documentation/html/client_api/accountclient.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Python Client API</a><a class="navbar__item navbar__link" href="/documentation/bin/rucio">Command Line Client</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/started/before_you_get_started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/user/setting_up_the_rucio_client">User</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentation/operator/setting_up_demo">Operator</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/setting_up_demo">Setting up a Rucio demo environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/kubernetes">Setting up Rucio on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_server">Installing Rucio Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_daemons">Installing Rucio Daemons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/k8s_guide">A Kubernetes tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/multi_vo_rucio">Multi-VO Rucio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/database">Database Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/administration">Administration Tricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration_parameters">Configuration parameters</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/operator/transfers/transfers-overview">Transfers</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/did_meta">DID Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/operator/policy_packages">Policy Packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/s3_rse_config">S3 Storage Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/qos_rse_config">QoS RSE Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/notifications">Notifications</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/documentation/category/executables">Executables</a><button aria-label="Expand sidebar category &#x27;Executables&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/developer/setting_up_mac_apple_silicon">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/project_organisation">About Us</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operator</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Policy Packages</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Policy Packages</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2>
<p>Policy packages are separate Python packages that can be used to add
experiment-specific customisations to Rucio. They typically customise
Rucio&#x27;s handling of permissions and schema as well as optionally adding
their own algorithms for various purposes, such as lfn to pfn conversion
and surl construction.</p>
<p>Policy packages may be installed from a Python package repository such
as <a href="https://pypi.python.org/" target="_blank" rel="noopener noreferrer">PyPi</a> or they may simply be installed in a
local directory. In the latter case this directory will need to be added
to the Rucio server&#x27;s <code>PYTHONPATH</code> environment variable.</p>
<p>The name of the policy package in use is specified by the <code>package</code> value
in the <code>policy</code> section of the Rucio configuration file. Alternatively,
the package can be specified by the <code>RUCIO_POLICY_PACKAGE</code> environment
variable (if both are set, the environment variable takes priority). If
no package is specified, a built in generic policy will be used. If a
package is specified but cannot be loaded, Rucio will exit with an error.</p>
<p>Multi-VO Rucio installations can load a different policy package for each
VO. In this case, the configuration parameter or environment variable name
is suffixed with the VO name (for example, <code>package-vo1</code> or
<code>RUCIO_POLICY_PACKAGE_VO1</code>).</p>
<p><a href="/documentation/html/rse_policies/rsemanager.html" target="_blank" rel="noopener noreferrer">The API for policy packages can be found here.</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-policy-package">Creating a policy package<a href="#creating-a-policy-package" class="hash-link" aria-label="Direct link to Creating a policy package" title="Direct link to Creating a policy package">​</a></h2>
<p>The basic elements of a policy package are the following:</p>
<ul>
<li>An <code>__init__.py</code> file that:<!-- -->
<ul>
<li>indicates the supported Rucio version via the <code>SUPPORTED_VERSION</code> field;</li>
<li>indicates the algorithms provided by the package (optional)</li>
</ul>
</li>
<li>A <code>permission.py</code> module implementing permission
customisations (optional).</li>
<li>A <code>schema.py</code> module implementing schema customization (optional).</li>
<li>One or more files for experiment-specific algorithms (optional).</li>
</ul>
<p>The recommended Python package layouts can be found <a href="https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/" target="_blank" rel="noopener noreferrer">here</a>. An example <code>src</code>-layout based policy package is as such:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">experiment-rucio-policy-package</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   README.md</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   pyproject.toml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└───src</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   └───experiment-rucio-policy-package</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   __init__.py               # required</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   permission.py             # optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   schema.py                 # optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   pfn2lfn.py                # optional (deterministic scope translation algorithm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   non_deterministic_pfn.py  # optional (non-deterministic scope translation algorithm)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│       │   ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="__init__py"><code>__init__.py</code><a href="#__init__py" class="hash-link" aria-label="Direct link to __init__py" title="Direct link to __init__py">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="supported_version"><code>SUPPORTED_VERSION</code><a href="#supported_version" class="hash-link" aria-label="Direct link to supported_version" title="Direct link to supported_version">​</a></h4>
<p><code>__init__.py</code> should define a <code>str | list[str]</code> called <code>SUPPORTED_VERSION</code>,
indicating the version(s) of Rucio that your package supports.</p>
<p>This is checked against the Rucio server
version to ensure compatibility when loading the policy package.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="from-rucio-36">From Rucio 36<a href="#from-rucio-36" class="hash-link" aria-label="Direct link to From Rucio 36" title="Direct link to From Rucio 36">​</a></h5>
<p>From Rucio 36, version checking was modified
to use <a href="https://peps.python.org/pep-0440/#version-specifiers" target="_blank" rel="noopener noreferrer">PEP-compliant version specifiers</a>.</p>
<p>For example, to specify support for the entire Rucio 36 release line (so 36.1.0, 36.2.0...)
without yet supporting Rucio 37,
the <a href="https://peps.python.org/pep-0440/#compatible-release" target="_blank" rel="noopener noreferrer"><strong>compatible release</strong> operator</a> <code>~=</code>
can be used, as seen below.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUPPORTED_VERSION </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;~=36.0&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Multiple constraints can be specified, either as a string:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUPPORTED_VERSION </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;~=36.0,!=36.4.0&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or as a list:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUPPORTED_VERSION </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;~=36.0&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;!=36.4.0&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="before-rucio-36">Before Rucio 36<a href="#before-rucio-36" class="hash-link" aria-label="Direct link to Before Rucio 36" title="Direct link to Before Rucio 36">​</a></h5>
<p>On Rucio versions older than 36, only major versions can be specified.
This can be done as either a string:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUPPORTED_VERSION </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;35&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or as a list, to indicate support for multiple major versions:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SUPPORTED_VERSION </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;34&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;35&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="get_algorithms"><code>get_algorithms</code><a href="#get_algorithms" class="hash-link" aria-label="Direct link to get_algorithms" title="Direct link to get_algorithms">​</a></h4>
<p>The <code>__init__.py</code> file can also contain
an optional function called <code>get_algorithms</code> that
returns a dictionary of custom algorithms implemented within the package.
In fact, this structure should be a &quot;dictionary of dictionaries&quot; where
the outer dictionary contains algorithm types, and each inner
dictionary contains all the algorithms provided by the package for that
type. Currently supported types are <code>lfn2pfn</code> for generating PFNs for
deterministic storage, <code>non_deterministic_pfn</code> for generating PFNs for
non-deterministic storage, and <code>scope</code> for scope extraction algorithms.
(For backwards compatibility, <code>surl</code> can be used in place of
<code>non_deterministic_pfn</code>, however this is not recommended for new policy
packages).</p>
<p>Some base algorithm classes depend on <code>schema</code> being loaded.
To avoid circular import issues, import the algorithm classes
as part of the <code>get_algorithms</code> function, to ensure that <code>schema</code> is loaded first.</p>
<p>Example:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_algorithms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> vo_policy_package</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">non_deterministic_pfn </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VONonDeterministicPFNAlgorithm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> vo_policy_package</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lfn2pfn </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VORSEDeterministicTranslation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> vo_policy_package</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">scope </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> VOScopeExtractionAlgorithm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;non_deterministic_pfn&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;voname_non_deterministic_pfn&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> VONonDeterministicPFNAlgorithm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">construct_non_deterministic_pfn_voname </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;lfn2pfn&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;voname_lfn2pfn&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> VORSEDeterministicTranslation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lfn2pfn_voname </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;scope&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;voname_extract_scope&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> VOScopeExtractionAlgorithm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">extract_scope_voname </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In all cases the names used to register the functions (e.g. <code>voname_extract_scope</code>) must be prefixed
with the name of the virtual organisation that owns the policy package,
to avoid naming conflicts on multi-VO Rucio installations.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="permission-and-schema-modules">Permission and schema modules<a href="#permission-and-schema-modules" class="hash-link" aria-label="Direct link to Permission and schema modules" title="Direct link to Permission and schema modules">​</a></h3>
<p>The <code>permission.py</code> and <code>schema.py</code> modules are optional; an experiment
that does not need to customise these modules can omit one or both of
them from the policy package and the Rucio generic versions will be
used instead. If these modules are required, the easiest way to create
them is to modify the generic versions from the Rucio codebase. These
can be found in
<a href="https://github.com/rucio/rucio/blob/master/lib/rucio/core/permission/generic.py" target="_blank" rel="noopener noreferrer"><code>lib/rucio/core/permission/generic.py</code></a>
and <a href="https://github.com/rucio/rucio/blob/master/lib/rucio/common/schema/generic.py" target="_blank" rel="noopener noreferrer"><code>lib/rucio/common/schema/generic.py</code></a> respectively.</p>
<p>The <code>has_permission</code> function in the permission module may return <code>None</code>
if your experiment does not implement a custom permission check for a
particular action. In this case, the generic permission module will be
called for this action instead.</p>
<p>The schema module of a policy package does not need to define all of
the schema values. Any missing ones will automatically be loaded from
the generic schema module instead.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="policy-algorithms">Policy algorithms<a href="#policy-algorithms" class="hash-link" aria-label="Direct link to Policy algorithms" title="Direct link to Policy algorithms">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-new-algorithm-class">Adding a new algorithm class<a href="#adding-a-new-algorithm-class" class="hash-link" aria-label="Direct link to Adding a new algorithm class" title="Direct link to Adding a new algorithm class">​</a></h3>
<p>The system for registering algorithms within policy packages is
intended to be extensible so that new algorithm classes can be added
relatively easily. The basic workflow is as follows:</p>
<ul>
<li>The <code>get_algorithms</code> function within the policy package (see above)
should return a dictionary of functions of the new class, indexed
by name</li>
<li>The core Rucio code should maintain a dictionary of functions of the
new class, ready to be called when required. The details of this
will differ depending on what the new class actually does and how it
integrates with the Rucio code, but typically the algorithm name to
be used will be selected by a value in the config file, as for the
current <code>lfn2pfn</code> and <code>non_deterministic_pfn</code> algorithm types.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lfn2pfn-vs-non_deterministic_pfn-algorithms">lfn2pfn vs. non_deterministic_pfn algorithms<a href="#lfn2pfn-vs-non_deterministic_pfn-algorithms" class="hash-link" aria-label="Direct link to lfn2pfn vs. non_deterministic_pfn algorithms" title="Direct link to lfn2pfn vs. non_deterministic_pfn algorithms">​</a></h3>
<p><code>lfn2pfn</code> algorithms and <code>non_deterministic_pfn</code> algorithms are
conceptually similar, but there are important differences between
them. Both produce a physical filename for use on an RSE, however
<code>lfn2pfn</code> algorithms can only be used on deterministic RSEs - for
example, disk systems where the appropriate physical filename can be
derived from the file&#x27;s scope and name alone (as well as
protocol-specific information for the RSE in question).
<code>non_deterministic_pfn</code> algorithms are used on non-deterministic
RSEs (most often tape systems), and may use additional information
about the file (such as its metadata, any datasets that it is a part
of, etc.) to construct the physical filename. Because files cannot
be uploaded directly to non-deterministic storage,
<code>non_deterministic_pfn</code> algorithms are only ever called for
replications, but <code>lfn2pfn</code> algorithms can also be called for
initial uploads.</p>
<p>The <code>lfn2pfn</code> algorithm to be used is determined by the
<code>lfn2pfn_algorithm</code> attribute of the relevant RSE. If this is not set,
the <code>lfn2pfn_algorithm_default</code> value from the <code>[policy]</code> section of
the config file is used instead. The <code>non_deterministic_pfn</code> algorithm
to be used is determined by the <code>naming_convention</code> attribute of the
relevant RSE.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploying-policy-packages-in-containers">Deploying Policy Packages in containers<a href="#deploying-policy-packages-in-containers" class="hash-link" aria-label="Direct link to Deploying Policy Packages in containers" title="Direct link to Deploying Policy Packages in containers">​</a></h2>
<p>It is now common to deploy Rucio using containers managed by software
such as Docker and Kubernetes. This section of the documentation is
intended to give guidance on how policy packages can be deployed in
this type of environment.</p>
<p>Broadly speaking, three things must happen in order for a policy
package to be deployed successfully:</p>
<ol>
<li>The policy package code must be available to the Rucio server
(and possibly other components such as daemons).</li>
<li>The directory containing the policy package must be in the server&#x27;s
<code>PYTHONPATH</code>.</li>
<li>The policy package name must be set in the Rucio configuration file,
or using the <code>RUCIO_POLICY_PACKAGE</code> environment variable.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-the-policy-package">Installing the policy package<a href="#installing-the-policy-package" class="hash-link" aria-label="Direct link to Installing the policy package" title="Direct link to Installing the policy package">​</a></h3>
<p>There are a few possible ways to get the policy package code into the
container where the server runs. One way is to build a custom
experiment-specific container image based on the generic Rucio server
image, and to install the policy package at build time in the
<code>Dockerfile</code>, either by directly copying the files in, or by installing
it from some sort of repository. For experiments that already customise
the container image, this is likely to be the easiest option.</p>
<p>Alternatively, the standard Rucio container can be used and a volume
containing the policy package files can be mounted at run time (using
the <code>-v</code> or <code>--volume</code> command line flag). When using Kubernetes, there
is also a third possibility: use an
<a href="https://kubernetes.io/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener noreferrer">init container</a>
to install the policy package onto a shared volume, which is then mounted
by the server container when it starts up.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-the-policy-package-to-the-servers-pythonpath">Adding the policy package to the server&#x27;s PYTHONPATH<a href="#adding-the-policy-package-to-the-servers-pythonpath" class="hash-link" aria-label="Direct link to Adding the policy package to the server&#x27;s PYTHONPATH" title="Direct link to Adding the policy package to the server&#x27;s PYTHONPATH">​</a></h3>
<p>It is possible to set environment variables within the container when
starting it (using Docker&#x27;s <code>-e</code> command line flag). This can be used to
set <code>PYTHONPATH</code>, however this will replace the original value rather
than appending to it, so there is a risk of removing other important
items from the path. A safer option is to override Rucio&#x27;s
<code>docker-entrypoint.sh</code> script and instead use a script that appends the
policy package&#x27;s directory to <code>PYTHONPATH</code> before starting the HTTP server.
This can be done either at build time in the <code>Dockerfile</code>, or at run time
using the <code>--entrypoint</code> command line option.</p>
<p>When deploying using Kubernetes and Helm charts, it is possible to specify
the policy package directory in the <code>optional_config:</code> section of
<code>values.yaml</code>. This is then propagated to the container as an environment
variable, which can be added to <code>PYTHONPATH</code> by the entry point script. For
example, include this in <code>values.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">optional_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">policy_pkg_path</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /opt/rucio/policy</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will appear in the container&#x27;s environment as a variable called
<code>POLICY_PKG_PATH</code>, which can be added to <code>PYTHONPATH</code> by the entry point
script before starting the server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">if [ ! -z &quot;$POLICY_PKG_PATH&quot; ]; then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    export PYTHONPATH=${POLICY_PKG_PATH}:${PYTHONPATH:+:}${PYTHONPATH}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="specifying-the-policy-package-in-the-configuration-file">Specifying the policy package in the configuration file<a href="#specifying-the-policy-package-in-the-configuration-file" class="hash-link" aria-label="Direct link to Specifying the policy package in the configuration file" title="Direct link to Specifying the policy package in the configuration file">​</a></h3>
<p>It is likely that most experiments are already customising the Rucio
configuration file, in which case the policy package (<code>package = name</code> in
the <code>[policy]</code> section) can simply be added to the existing customised file.
Alternatively, the package name can be set in the <code>RUCIO_POLICY_PACKAGE</code>
environment variable (see previous section for how to pass environment
variables into the server container).</p>
<p>When deploying using Kubernetes and Helm charts, it is possible to specify
configuration options in <code>values.yaml</code>. Values included in the <code>config:</code>
section of this file are automatically merged into <code>rucio.cfg</code> by the
<code>docker-entrypoint.sh</code> script, so the policy package can be set as:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">policy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">package</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> packagename</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/operator/policy_packages.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-03-13T12:05:32.000Z" itemprop="dateModified">Mar 13, 2025</time></b> by <b>Giovanni Guerrieri</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/operator/did_meta"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DID Metadata</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/operator/s3_rse_config"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">S3 Storage Configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#creating-a-policy-package" class="table-of-contents__link toc-highlight">Creating a policy package</a><ul><li><a href="#__init__py" class="table-of-contents__link toc-highlight"><code>__init__.py</code></a></li><li><a href="#permission-and-schema-modules" class="table-of-contents__link toc-highlight">Permission and schema modules</a></li></ul></li><li><a href="#policy-algorithms" class="table-of-contents__link toc-highlight">Policy algorithms</a><ul><li><a href="#adding-a-new-algorithm-class" class="table-of-contents__link toc-highlight">Adding a new algorithm class</a></li><li><a href="#lfn2pfn-vs-non_deterministic_pfn-algorithms" class="table-of-contents__link toc-highlight">lfn2pfn vs. non_deterministic_pfn algorithms</a></li></ul></li><li><a href="#deploying-policy-packages-in-containers" class="table-of-contents__link toc-highlight">Deploying Policy Packages in containers</a><ul><li><a href="#installing-the-policy-package" class="table-of-contents__link toc-highlight">Installing the policy package</a></li><li><a href="#adding-the-policy-package-to-the-servers-pythonpath" class="table-of-contents__link toc-highlight">Adding the policy package to the server&#39;s PYTHONPATH</a></li><li><a href="#specifying-the-policy-package-in-the-configuration-file" class="table-of-contents__link toc-highlight">Specifying the policy package in the configuration file</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
</body>
</html>