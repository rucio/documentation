<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-operator/k8s_guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">A Kubernetes tutorial | Rucio Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rucio.github.io/documentation/operator/k8s_guide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="A Kubernetes tutorial | Rucio Documentation"><meta data-rh="true" name="description" content="This tutorial contains some parts that are CERN-specific."><meta data-rh="true" property="og:description" content="This tutorial contains some parts that are CERN-specific."><link data-rh="true" rel="icon" href="/documentation/img/android-chrome-512x512.png"><link data-rh="true" rel="canonical" href="https://rucio.github.io/documentation/operator/k8s_guide"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/k8s_guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://rucio.github.io/documentation/operator/k8s_guide" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://NDP6TP9QYQ-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"A Kubernetes tutorial","item":"https://rucio.github.io/documentation/operator/k8s_guide"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Rucio Documentation" href="/documentation/opensearch.xml">

<link rel="stylesheet" href="/documentation/css/custom.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/documentation/assets/css/styles.1dc85473.css">
<script src="/documentation/assets/js/runtime~main.b31910e2.js" defer="defer"></script>
<script src="/documentation/assets/js/main.c5f796cd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_black.svg"><link rel="preload" as="image" href="/documentation/img/rucio_horizontaled_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/rucio_horizontaled_black.svg" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Rucio Documentation</b></a><a href="/documentation/html/client_api/accountclient.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Python Client API</a><a class="navbar__item navbar__link" href="/documentation/bin/rucio">Command Line Client</a><a href="/documentation/html/rest_api_doc.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">REST API</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/started/before_you_get_started">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/user/setting_up_the_rucio_client">User</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/documentation/operator/setting_up_demo">Operator</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/setting_up_demo">Setting up a Rucio demo environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/kubernetes">Setting up Rucio on Kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_server">Installing Rucio Server</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/documentation/operator/policy_packages/policy_packages_overview">Policy Packages</a><button aria-label="Expand sidebar category &#x27;Policy Packages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/installing_daemons">Installing Rucio Daemons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/administration">Administration Tricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/configuration_parameters">Configuration parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/database">Database Operations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/did_meta">DID Metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/operator/k8s_guide">A Kubernetes tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/multi_vo_rucio">Multi-VO Rucio</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/notifications">Notifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/opendata">Opendata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/qos_rse_config">QoS RSE Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/s3_rse_config">S3 Storage Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/operator/suspicious-replica-recoverer">Suspicious Replica Recoverer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/operator_transfers/configure-rucio-fts3-plugins">Transfers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/documentation/bin/rucio-abacus-account">Executables</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/developer/dependency_management">Developer</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/documentation/project_organisation">About Us</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Operator</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">A Kubernetes tutorial</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Getting Started</h1></header>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>DISCLAIMER</div><div class="admonitionContent_BuS1"><p>This tutorial contains some parts that are CERN-specific. <br>
The tools utilised to set up and to run the cluster are chosen accordingly. Feel free to use your own.</p></div></div>
<p>In order to efficiently manage the cluster and implement continuous delivery, the following tools are required.</p>
<ul>
<li>
<p><strong>Kubernetes</strong>: <code>kubectl</code>
(<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener noreferrer">Reference Documentation</a>).</p>
</li>
<li>
<p><strong>Helm Charts</strong>
(<a href="https://helm.sh/docs/intro/install/#from-script" target="_blank" rel="noopener noreferrer">Reference Documentation</a>). <br>
To install Helm, execute:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod 700 get_helm.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./get_helm.sh</span><br></span></code></pre></div></div>
<p>Also, add the <code>bitnami</code> repo:</p>
<div class="language-helm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-helm codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo add bitnami https://charts.bitnami.com/bitnami</span><br></span></code></pre></div></div>
<p>So that we can search the repo with <code>helm search repo bitnami</code>.</p>
</li>
<li>
<p><strong>Continuous delivery</strong>: <code>flux</code>
(<a href="https://fluxcd.io/flux/get-started/" target="_blank" rel="noopener noreferrer">Reference Documentation</a>).</p>
<ul>
<li><a href="https://fluxcd.io/flux/installation/#install-the-flux-cli" target="_blank" rel="noopener noreferrer">Install the Flux CLI</a>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -s https://fluxcd.io/install.sh | sudo bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git status</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git add .</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git commit -m &quot;first commit&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git push</span><br></span></code></pre></div></div>
</li>
<li><a href="https://fluxcd.io/flux/cmd/flux_bootstrap_gitlab/" target="_blank" rel="noopener noreferrer">Bootstrap Flux</a>
Then setup the flux in the gitlab repo (we recommend to clone it via https), run the command<!-- -->
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">flux bootstrap gitlab \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --owner=&lt;git-user-or-group-name&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --repository=&lt;repository-name&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --branch=&lt;main-branch&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --path=&lt;path-where-to-sync&gt; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --hostname=gitlab.cern.ch \ </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  --deploy-token-auth</span><br></span></code></pre></div></div>
</li>
</ul>
</li>
</ul>
<p>The git deploy token will be requested as part of the auth process.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Why use <code> --deploy-token-auth</code></div><div class="admonitionContent_BuS1"><p>When using --deploy-token-auth, the CLI generates a GitLab project deploy token and stores it in the cluster as a Kubernetes Secret named flux-system inside the flux-system namespace. [<a href="https://fluxcd.io/flux/installation/bootstrap/gitlab/#gitlab-personal-account" target="_blank" rel="noopener noreferrer">Source</a>].</p></div></div>
<ul>
<li><strong>(optional) Monitoring</strong>: <code>k9s</code>. <br>
Get the binary from <a href="https://github.com/derailed/k9s/releases" target="_blank" rel="noopener noreferrer">here</a> looking for the proper dist; extract, and move to <code>/usr/local/bin/</code>.</li>
</ul>
<h1>Setting up the CERN infrastructure</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-rucio-cluster-on-openstack">Creating the Rucio cluster on Openstack<a href="#creating-the-rucio-cluster-on-openstack" class="hash-link" aria-label="Direct link to Creating the Rucio cluster on Openstack" title="Direct link to Creating the Rucio cluster on Openstack">​</a></h2>
<p>Please refer to the <a href="https://kubernetes.docs.cern.ch/docs/getting-started/" target="_blank" rel="noopener noreferrer">documentation</a>.</p>
<p>There are two kinds of operative components within the cluster: the <em>master</em> and the <em>worker</em> nodes:</p>
<ul>
<li>The master node hosts the Kubernetes control plane and manages the cluster, including scheduling and scaling applications and maintaining the state of the cluster.</li>
<li>The worker nodes are responsible for running the containers and executing the workloads.</li>
</ul>
<p>It is recommended to choose a master node with a sufficient amount of memory, e.g. <code>m2.large</code>.</p>
<p>The minimum working configuration consists of 1 master node and 5 worker nodes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-database-with-dbod">Create the database with DBOD<a href="#create-the-database-with-dbod" class="hash-link" aria-label="Direct link to Create the database with DBOD" title="Direct link to Create the database with DBOD">​</a></h2>
<p>Create a DataBase On Demand (DBOD) using the <a href="https://dbod.web.cern.ch/pages/dashboard" target="_blank" rel="noopener noreferrer">DBOD dashboard</a>;  <code>postgres</code> is highly recommended.</p>
<ul>
<li>The operator will have to wait for the db to be approved. Will get a mail and will receive admin credentials (to be changed) as shown below.</li>
</ul>
<p>Additional resources:</p>
<ul>
<li><a href="https://github.com/vre-hub/vre/wiki/Software-components#2-database" target="_blank" rel="noopener noreferrer">https://github.com/vre-hub/vre/wiki/Software-components#2-database</a></li>
<li><a href="https://codimd.web.cern.ch/s/ZFIkp7PWG#2-Database-configuration" target="_blank" rel="noopener noreferrer">https://codimd.web.cern.ch/s/ZFIkp7PWG#2-Database-configuration</a></li>
</ul>
<p>Once the db creation is finalised, we can use <code>psql</code>, to set up the credentials.
In the following example, we chose the name <code>rucioitdb</code> for the database; in general, the naming of the DBOD instance is the operator&#x27;s choice:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dnf install postgresql-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">psql -h dbod-rucioitdb.cern.ch -U admin -p &lt;port&gt; -c &#x27;\password&#x27;</span><br></span></code></pre></div></div>
<p>Details about which port to connect to, etc can be found on the DBOD dashboard.</p>
<p>While connected to the PostgreSQL instance, we can create the rucio database and assign ownership to a dedicated rucio user as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DATABASE</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> ROLE rucio </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> LOGIN PASSWORD </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xxx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">GRANT</span><span class="token plain"> rucio </span><span class="token keyword" style="font-style:italic">TO</span><span class="token plain"> admin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DATABASE</span><span class="token plain"> rucio OWNER </span><span class="token keyword" style="font-style:italic">TO</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre></div></div>
<p>Then, modify the <code>pg.hba.conf</code> configuration file on the DBOD dashboard with the following values, to allow <code>rucio</code> to access the db:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">host	rucio		rucio		0.0.0.0/0	md5</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bootstrapping-the-database">Bootstrapping the database<a href="#bootstrapping-the-database" class="hash-link" aria-label="Direct link to Bootstrapping the database" title="Direct link to Bootstrapping the database">​</a></h3>
<p>To bootstrap the db, there are two possibilities:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-the-rucio-db-init-container">1. The <a href="https://github.com/rucio/containers/tree/master/init" target="_blank" rel="noopener noreferrer">Rucio DB init container</a><a href="#1-the-rucio-db-init-container" class="hash-link" aria-label="Direct link to 1-the-rucio-db-init-container" title="Direct link to 1-the-rucio-db-init-container">​</a></h4>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">docker run --rm \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e RUCIO_CFG_DATABASE_DEFAULT=&quot;postgresql://rucio:xxx@dbod-rucioitdb.cern.ch:&lt;port&gt;/rucio&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e RUCIO_CFG_BOOTSTRAP_USERPASS_IDENTITY=&quot;admin&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -e RUCIO_CFG_BOOTSTRAP_USERPASS_PWD=&quot;xxx&quot; \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rucio/rucio-init</span><br></span></code></pre></div></div>
<p>This command will setup all the necessary tables in the db, and additionally will create a rucio admin user. The admin user will be used when setting up rucio. <em><strong>Please take note of the username and passw.</strong></em></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Notice the syntax of <code>RUCIO_CFG_DATABASE_DEFAULT=&quot;postgresql://&lt;db-user&gt;:&lt;passw&gt;@&lt;dbod-url&gt;:&lt;dobd-port&gt;/&lt;db-name&gt;&quot;</code></p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-the-bootstrapping-pod">2. The bootstrapping pod<a href="#2-the-bootstrapping-pod" class="hash-link" aria-label="Direct link to 2. The bootstrapping pod" title="Direct link to 2. The bootstrapping pod">​</a></h4>
<p>Create a <code>init-pod.yaml</code> file and apply it as specified in the readme of the <a href="https://github.com/rucio/k8s-tutorial/blob/master/README.md" target="_blank" rel="noopener noreferrer">k8s_tutorial</a>, replace <code>&lt;PASSWORD&gt;</code> with the secret needed to connect to the database:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> init</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Never</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> init</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio/rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">imagePullPolicy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Always</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RUCIO_CFG_DATABASE_DEFAULT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> postgresql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">&lt;PASSWORD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">@postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">postgresql/rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RUCIO_CFG_BOOTSTRAP_USERPASS_IDENTITY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RUCIO_CFG_BOOTSTRAP_USERPASS_PWD</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> xxx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RUCIO_PRINT_CFG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;true&quot;</span><br></span></code></pre></div></div>
<p>And then apply the pod config:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f init-pod.yaml</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Please notice that in this case, the various credentials will have to be properly stored as secrets. See the Managing Secrets section for more information.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-landb-set">Creating a LanDB set<a href="#creating-a-landb-set" class="hash-link" aria-label="Direct link to Creating a LanDB set" title="Direct link to Creating a LanDB set">​</a></h2>
<blockquote>
<p>In order to <a href="https://security.web.cern.ch/services/en/firewall.shtml" target="_blank" rel="noopener noreferrer">protect devices connected to the CERN network</a> from the regular attacks initiated from off-site, <strong>incoming connections to all CERN devices are blocked</strong> in the CERN outer perimeter firewall by default. In addition, source ports <strong>0-1023/TCP and 0-1023/UDP (except 500/UDP) are blocked by default</strong> for outgoing connections. Thus, users can initiate client applications (on so-called higher ports) but not expose server processes.</p>
</blockquote>
<p>To comply with the CERN security rules, we need to use the so-called LANDB sets, where the firewall has static openings automatically set up. Usually, such sets are used for redundancy or large, homogeneous services. These sets are either managed by the Computer Security Team or by the service managers themselves.</p>
<p>Create a <a href="https://landb.cern.ch/portal/sets/create" target="_blank" rel="noopener noreferrer">new LanDB set</a>, following the recommendations:</p>
<ol>
<li>Type: Interdomain</li>
<li>Network Domain: GPN</li>
<li>Responsible: <code>&lt;your-egroup&gt;</code></li>
<li>Description: use the following fields:</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">OPENSTACK_PROJECT=cc059d57-6e98-4688-a3be-aae2b451868b,&lt;your-openstack-project-ID&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>LoadBalancer tip</div><div class="admonitionContent_BuS1"><p>The ID <code>cc059d57-6e98-4688-a3be-aae2b451868b</code> will allow the LoadBalancer as a Service (LBaaS) instance to <a href="https://clouddocs.web.cern.ch/networking/load_balancing.html#adding-load-balancer-to-landb-sets" target="_blank" rel="noopener noreferrer">assign LoadBalancers to this set</a>. In the specific case of the COMPASS rucio instance, the <code>openstack-landb-set-access</code> is being set as a member of the <code>rucio-it-admins</code> egroup.
Please refer to the LoadBalancers section for more information.</p></div></div>
<p><img decoding="async" loading="lazy" alt="image" src="/documentation/assets/images/landb-set-create-7bd6f755e54e709c68731df2554e05b1.png" width="1320" height="632" class="img_ev3q"></p>
<h1>Populating the cluster</h1>
<p>There are four main components that need to be installed in order to have the Rucio cluster operative:</p>
<ol>
<li>Rucio Servers</li>
<li>Rucio Authentication</li>
<li>Rucio Daemons</li>
<li>Rucio Web UI</li>
</ol>
<p>The following sections are based on the deployment of the <a href="https://gitlab.cern.ch/rucio-it/flux-compass" target="_blank" rel="noopener noreferrer">COMPASS Rucio instance</a>, within the CERN infrastructure.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="managing-secrets">Managing secrets<a href="#managing-secrets" class="hash-link" aria-label="Direct link to Managing secrets" title="Direct link to Managing secrets">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sealed-secrets">Sealed-Secrets<a href="#sealed-secrets" class="hash-link" aria-label="Direct link to Sealed-Secrets" title="Direct link to Sealed-Secrets">​</a></h3>
<p><a href="https://github.com/bitnami-labs/sealed-secrets?tab=readme-ov-file#installation" target="_blank" rel="noopener noreferrer">Reference Documentation</a>.
<a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/sync/sealed-secrets.yaml?ref_type=heads" target="_blank" rel="noopener noreferrer">Reference Helm chart</a>.</p>
<p>A very efficient way of managing secrets in the cluster is Bitnami&#x27;s Sealed-Secrets. Install the Helm chart by executing:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">helm repo add sealed-secrets https://bitnami-labs.github.io/sealed-secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create namespace sealed-secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f sealed-secrets.yaml </span><br></span></code></pre></div></div>
<p>An example of the <code>sealed-secrets.yaml</code> configuration file is provided below:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source.toolkit.fluxcd.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> HelmRepository</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//bitnami</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">labs.github.io/sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> helm.toolkit.fluxcd.io/v2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> HelmRelease </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">releaseName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">chart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">sourceRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> HelmRepository</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">chart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> sealed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 5m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 2.15.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">fullnameOverride</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sealed-secrets-controller&quot;</span><br></span></code></pre></div></div>
<p>Notice that <code>yaml</code> files can be concatenated thanks to the <code>---</code> separator.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-secrets-for-the-cluster">Creating secrets for the cluster<a href="#creating-secrets-for-the-cluster" class="hash-link" aria-label="Direct link to Creating secrets for the cluster" title="Direct link to Creating secrets for the cluster">​</a></h3>
<p><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/scripts?ref_type=heads" target="_blank" rel="noopener noreferrer">Reference secrets generation scripts</a>.</p>
<p>The creation of secrets can be based on the following process:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">HELM_RELEASE=&quot;rucio-servers&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RAW_SECRETS_SERVERS=&quot;/root/compass-rucio-certs/servers&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># kubeseal controller namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTROLLER_NS=&quot;sealed-secrets&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTROLLER_NAME=&quot;sealed-secrets-controller&quot; # This can be checked in k8s/Services</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># rucio namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUCIO_NS=&quot;rucio&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Output dir</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SECRETS_STORE=&quot;/root/flux-compass/SECRETS/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># name of output secret to apply</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OUTPUT_SECRET=&quot;ruciocompass-db.yaml&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create secret generic ${HELM_RELEASE}-server-hostcert --dry-run=client --from-file=${RAW_SECRETS_SERVERS}/hostcert.pem -o yaml | \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubeseal --controller-name=${CONTROLLER_NAME} --controller-namespace=${CONTROLLER_NS} --format yaml --namespace=${RUCIO_NS} &gt; ${SECRETS_STORE}/ss_${OUTPUT_SECRET}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f ${SECRETS_STORE}/ss_${OUTPUT_SECRET}</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li><code>HELM_RELEASE</code> is the name of the helm release that is being used.</li>
<li><code>RAW_SECRETS_SERVERS</code> is the path in which the files that will be used as secrets are stored</li>
<li><code>CONTROLLER_NS</code> is the namespace assigned to the secrets manager.</li>
<li><code>CONTROLLER_NAME</code> is the name of the secrets manager controller.</li>
<li><code>RUCIO_NS</code> is the namespace related to Rucio (in the COMPASS case, it is called <code>rucio</code>).</li>
<li><code>SECRETS_STORE</code> path to which the files containing the encrypted secrets will be stored. These files will be used by flux.</li>
</ul>
<p><code>kubectl create secret generic</code> Creates a secret from the specific file that needs to be transposed to a secret.</p>
<p>Then <code>kubeseal</code> perform the encryption and the encoding, saving the secret to a file stored in <code>SECRETS_STORE</code>.
Finally, <code>kubectl apply</code> applies the secret to the cluster. Please notice that this is eventually also achieved via flux, by pushing the secret file to the repository.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Secret tip</div><div class="admonitionContent_BuS1"><p>IF <code>kubeseal</code> returns an error, it&#x27;s probably because it&#x27;s not installed:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">wget https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.18.0/kubeseal-0.18.0-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tar xfz kubeseal-0.18.0-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo install -m 755 kubeseal /usr/local/bin/kubeseal</span><br></span></code></pre></div></div><p>Adjust the version and the build details according to your machine.</p></div></div>
<p>The content of the secret will be of this type:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bitnami.com/v1alpha1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> SealedSecret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">servers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">hostcert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">encryptedData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">hostcert.pem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> &lt;encrypted secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">creationTimestamp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token null important">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">servers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">hostcert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-servers">Rucio Servers<a href="#rucio-servers" class="hash-link" aria-label="Direct link to Rucio Servers" title="Direct link to Rucio Servers">​</a></h2>
<blockquote>
<p>The Rucio servers are the backbone of the Rucio system. They handle all core functionalities including data management, rule-based data replication, data placement, and monitoring. The servers ensure the integrity and availability of data across various storage systems.</p>
</blockquote>
<p>First of all, create a namespace for rucio:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create namespace rucio</span><br></span></code></pre></div></div>
<p>And consequently create a helm repository config file <code>rucio-helm-repo.yaml</code>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> source.toolkit.fluxcd.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> HelmRepository</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//rucio.github.io/helm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">charts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 1m</span><br></span></code></pre></div></div>
<p>Then apply it using kubectl:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f /path/rucio-helm-repo.yaml</span><br></span></code></pre></div></div>
<p>At this point, in order to setup this service, four more steps are needed:</p>
<ol>
<li>Produce the Helm chart.</li>
<li>Create the DB secret</li>
<li>Setup the LoadBalancers (LBs).</li>
<li>Produce the certificates related to the <code>landb-alias</code> used.</li>
<li>Add the certificates as secrets and mount them on the k8s pods.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="produce-the-helm-chart">Produce the Helm chart<a href="#produce-the-helm-chart" class="hash-link" aria-label="Direct link to Produce the Helm chart" title="Direct link to Produce the Helm chart">​</a></h3>
<p>Please look at the <a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/sync/rucio-servers.yaml?ref_type=heads" target="_blank" rel="noopener noreferrer">currently used one</a>.
A few remarks:</p>
<ul>
<li>The db secret is being mounted on <code>config.database.default</code> in order to allow the user to correctly access it.</li>
<li><code>hostcert.pem</code>, <code>hostkey.pem</code> and <code>ca.pem</code> are automatically detected, so they don&#x27;t need to be mounted. Nevertheless, the corresponding secrets must be created (see next sections).</li>
<li>The GridCA cert is needed to verify all the other certs. Please look at this <a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/commit/688da7285833dafd1bbe25469f35c6059d7af24f" target="_blank" rel="noopener noreferrer">git commit</a> used to set the <code>GridCA</code> file in <code>/etc/grid-security/certificate</code>.<!-- -->
<ul>
<li>Together with this, is also necessary to setup the corresponding variable <code>RUCIO_CA_PATH</code></li>
</ul>
</li>
<li>The <code>RUCIO_SSL_PROTOCOL</code> variable must be explicitly set.</li>
</ul>
<p>Please notice that in order to have LBs produced, <em><strong>the Helm chart must be applied</strong></em>.
This will come with several errors related to certificates, that will be fixed in the next steps.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-db-secret">Create the DB secret<a href="#create-the-db-secret" class="hash-link" aria-label="Direct link to Create the DB secret" title="Direct link to Create the DB secret">​</a></h3>
<p>Create the file rucio-db.yaml to register the secret:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">db</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">stringData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">dbfullstring</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> postgresql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">psw@dbod</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">instance.cern.ch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">port/db</span><br></span></code></pre></div></div>
<p>Add the secret using a script like this:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#!/bin/bash</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># kubeseal controller namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTROLLER_NS=&quot;sealed-secrets&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONTROLLER_NAME=&quot;sealed-secrets-controller&quot; # This can be checked in k8s/Services</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># rucio namespace</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">RUCIO_NS=&quot;rucio&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Output dir</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SECRETS_STORE=&quot;/root/flux-ams02/SECRETS/&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">source_file_secret=&quot;/root/flux-ams02/SECRETS/tmp_local_secrets/rucio-db.yaml&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># name of output secret to apply</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OUTPUT_SECRET=&quot;rucio-ams02-db.yaml&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cat ${source_file_secret} | kubeseal --controller-name=${CONTROLLER_NAME} --controller-namespace=${CONTROLLER_NS} --format yaml --namespace=${RUCIO_NS} &gt; ${SECRETS_STORE}/ss_${OUTPUT_SECRET}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f ${SECRETS_STORE}/ss_${OUTPUT_SECRET}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setup-the-lb">Setup the LB<a href="#setup-the-lb" class="hash-link" aria-label="Direct link to Setup the LB" title="Direct link to Setup the LB">​</a></h3>
<p>The minimal configuration for LoadBalancers is the following:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">service</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> LoadBalancer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">443</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> https</span><br></span></code></pre></div></div>
<p>With respect to the <a href="https://github.com/rucio/helm-charts/blob/7f8a7d9fb9cbcd01d645f24523a173c7f53fb101/charts/rucio-server/values.yaml#L33" target="_blank" rel="noopener noreferrer">original Helm chart</a>, that employs the Kubernetes native <a href="https://kubernetes.io/docs/concepts/services-networking/cluster-ip-allocation/" target="_blank" rel="noopener noreferrer"><code>ClusterIP</code></a> service, this configuration exploits the CERN native LBaaS, and exposes it over HTTPS.
This setup will trigger the <code>openstack-cloud-controller-manager</code> pod, and will automatically instantiate the requested LBs.</p>
<p>Please notice that in order to have LBs, one must request a quota change to the openstack project:
<img decoding="async" loading="lazy" alt="image" src="/documentation/assets/images/get-lbs-41489ce66c60397c92618aabc35c092b.png" width="898" height="496" class="img_ev3q"></p>
<p>To check the status of the LBs, the CLI command can be used:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer list</span><br></span></code></pre></div></div>
<p>Then, a few attributes must be changed in order to obtain the necessary DNS:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag landb-set=&quot;RUCIO-IT&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag landb-alias=&quot;compass-rucio.cern.ch&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --description=&quot;compass-rucio.cern.ch&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag main-user=&quot;rucio-it-admins&quot; &lt;lb-ID&gt;</span><br></span></code></pre></div></div>
<p>Now, the LB must be added to the LanDB set from the dashboard, under IP Addresses.
To do that, first retrieve the virtual IP address, <code>vip_address</code>, of the LB:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> openstack loadbalancer show &lt;lb-ID&gt; | grep vip_address</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>LoadBalancers are slow and automatic</div><div class="admonitionContent_BuS1"><p>The LB will be automatically added to the LanDB set allowed IPs.</p><p>IF this does <em><strong>not</strong></em> happen, follow the steps below:</p></div></div>
<p>It will take a while (~10 minutes) for the LB hostname to come up online, so do not panic if <code>host &lt;vip_address&gt;</code> doesn&#x27;t return anything immediately!</p>
<p>Retrieve the pointer to the LB, for instance:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">host &lt;vip_address&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">222.xx.xxx.xxx.in-addr.arpa domain name pointer lbaas-xxx4a6c2-xxxx-xxxx-xxxx-59489ffd7xxx.cern.ch.</span><br></span></code></pre></div></div>
<p>where <code>lbaas-xxx4a6c2-xxxx-xxxx-xxxx-59489ffd7xxx.cern.ch</code> represents the hostname of the LB.</p>
<p>Finally, add <code>lbaas-...cern.ch</code> to the list of allowed IP addresses in the LanDB set dashboard. Either the hostname or the <code>vip_address</code> used before can be used in the search bar.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="produce-the-certificates-related-to-the-landb-alias">Produce the certificates related to the landb-alias<a href="#produce-the-certificates-related-to-the-landb-alias" class="hash-link" aria-label="Direct link to Produce the certificates related to the landb-alias" title="Direct link to Produce the certificates related to the landb-alias">​</a></h3>
<p>Read the <a href="https://ca.cern.ch/ca/Help/?kbid=021002" target="_blank" rel="noopener noreferrer">help page</a> about Grid Host certs</p>
<p>Then, request a cert using <a href="https://ca.cern.ch/ca/host/HostSelection.aspx?template=EE2Host&amp;instructions=auto" target="_blank" rel="noopener noreferrer">dedicated page</a>.
In the current example, a cert for <code>compass-rucio.cern.ch</code> (corresponding to the LB <code>landdb-alias</code>) was requested:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Certs pro move</div><div class="admonitionContent_BuS1"><blockquote>
<p>Create a <a href="https://ca.cern.ch/ca/host/Request.aspx?template=ee2host" target="_blank" rel="noopener noreferrer">grid Host certificate</a> linked to both servers and auth domains. If you need, you can specify Subject Alternative Names (SANs) for your certificate, in DNS format in the SAN box. Then you&#x27;ll have one cert to rule them all:
<img decoding="async" loading="lazy" alt="image" src="/documentation/assets/images/grid-host-certs-ed167d94fb31652224f90b35cb83f23b.png" width="813" height="215" class="img_ev3q"></p>
</blockquote></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-host-key-ca-and-gridca-files">Create the <code>host</code>, <code>key</code>, <code>ca</code> and <code>GridCA</code> files<a href="#create-the-host-key-ca-and-gridca-files" class="hash-link" aria-label="Direct link to create-the-host-key-ca-and-gridca-files" title="Direct link to create-the-host-key-ca-and-gridca-files">​</a></h4>
<p>As recommended in the <a href="https://ca.cern.ch/ca/Help/?kbid=024100" target="_blank" rel="noopener noreferrer">documentation</a>, extract the certificate (which contains the public key) and the private key, using:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl pkcs12 -in compass-rucio.p12 -clcerts -nokeys -out hostcert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl pkcs12 -in compass-rucio.p12 -nocerts -nodes -out hostkey.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod 400 hostkey.pem </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">chmod 644 hostcert.pem </span><br></span></code></pre></div></div>
<p>Notice that to avoid protecting the key with a passphrase, the <code>-nodes</code> option is specified. Moreover, the appropriate permissions (<code>400</code>: read by owner, <code>644</code>: read by anyone, written by owner) for the extracted files are set.</p>
<p>These files have to be stored in the same path as described by the <code>RAW_SECRETS_SERVERS</code> variable used in the secrets creation.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="important-information-about-capem-and-gridcapem">Important information about <code>ca.pem</code> and <code>GridCA.pem</code><a href="#important-information-about-capem-and-gridcapem" class="hash-link" aria-label="Direct link to important-information-about-capem-and-gridcapem" title="Direct link to important-information-about-capem-and-gridcapem">​</a></h5>
<p>An additional file, <code>ca.pem</code> (i.e. <code>CERN-bundle.pem</code>) must be created.</p>
<p><code>CERN-bundle.pem</code> is a standard CA bundle provided by CERN, containing multiple CA certificates that CERN trusts. This file is used to verify the authenticity of other certificates within a secure communication process (e.g., SSL/TLS).</p>
<p>This file can be retrieved from lxplus:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp /etc/pki/tls/certs/CERN-bundle.pem compass-rucio-certs/servers/ca.pem</span><br></span></code></pre></div></div>
<p>The same goes for the <code>GridCA.pem</code> file:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp /etc/grid-security/certificates/CERN-GridCA.pem compass-rucio-certs/servers/GridCA.pem</span><br></span></code></pre></div></div>
<p>This file is used for the Certification Authority issuing SHA-2 certificates for Grid usage (user, host and robot certificates), in compliance with <a href="https://www.eugridpma.org/" target="_blank" rel="noopener noreferrer">EUGridPMA</a> policies.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods">Add the certificates as secrets and mount them on the k8s pods<a href="#add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods" class="hash-link" aria-label="Direct link to Add the certificates as secrets and mount them on the k8s pods" title="Direct link to Add the certificates as secrets and mount them on the k8s pods">​</a></h3>
<p>Now it is possible to run something similar to the <a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/scripts/rucio-servers-secret.sh?ref_type=heads" target="_blank" rel="noopener noreferrer">servers script</a> to add all the secrets to the cluster.</p>
<p>The output should be of this form:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Create and apply SERVER secrets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sealedsecret.bitnami.com/rucio-servers-server-hostcert configured</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sealedsecret.bitnami.com/rucio-servers-server-hostkey configured</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sealedsecret.bitnami.com/rucio-servers-server-cafile configured</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.</span><br></span></code></pre></div></div>
<p>The flux sync can be triggered by <em><strong>git pushing</strong></em> the content of the <code>SECRET</code> folder to the remote repository.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-auth">Rucio Auth<a href="#rucio-auth" class="hash-link" aria-label="Direct link to Rucio Auth" title="Direct link to Rucio Auth">​</a></h2>
<p><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/sync/rucio-servers-auth.yaml?ref_type=heads" target="_blank" rel="noopener noreferrer">Reference Helm chart</a>.</p>
<blockquote>
<p>The authentication component of Rucio is responsible for securely verifying the identities of users and services attempting to access the Rucio system. It ensures that only authorised entities can perform actions within the system.</p>
</blockquote>
<p>As for the servers, four steps are needed to deploy the authentication pod:</p>
<ol>
<li>Produce the Helm chart.</li>
<li>Setup the LB.</li>
<li>Produce the certificates related to the <code>landb-alias</code> used.</li>
<li>Add the certificates as secrets and mount them on the k8s pods.</li>
</ol>
<p>Based on the reference Helm chart, we can add a few remarks:</p>
<ol>
<li>Explicitly mounting secrets for <code>hostcert</code>, <code>hostkey</code>, and <code>ca</code>, via <code>secretMounts</code>.</li>
<li>The <code>httpd_config</code> configuration block:
this block maps the certificate to an account name.
Setting up <code>x509</code> auth can be very tricky, please make sure that the <a href="https://github.com/rucio/containers/blob/b51bbceb5aab0a1e07d48845f295cbbb175bdcb9/server/rucio.conf.j2#L104" target="_blank" rel="noopener noreferrer"><code>grid_site_enabled</code></a> parameter is set on <code>True</code>. <br>
This enables the <code>auth/x509_proxy</code> endpoint! <br>
The endpoint can be tested by executing<!-- -->
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">curl -k https://compass-rucio.cern.ch/auth/x509_proxy</span><br></span></code></pre></div></div>
</li>
</ol>
<p>Another important change is related to the LB attributes:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag landb-set=&quot;RUCIO-IT&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag landb-alias=&quot;compass-rucio-auth.cern.ch&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --description=&quot;compass-rucio-auth.cern.ch&quot; &lt;lb-ID&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openstack loadbalancer set --tag main-user=&quot;rucio-it-admins&quot; &lt;lb-ID&gt;</span><br></span></code></pre></div></div>
<p>Here, the <code>landb-alias</code> attribute and the <code>description</code> have been changed with respect to servers. The choice of the alias must comply with the naming used while creating the host certificates.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-daemons">Rucio Daemons<a href="#rucio-daemons" class="hash-link" aria-label="Direct link to Rucio Daemons" title="Direct link to Rucio Daemons">​</a></h2>
<p><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/sync/rucio-daemons.yaml?ref_type=heads" target="_blank" rel="noopener noreferrer">Reference Helm chart</a>.<br>
<a href="/documentation/operator/installing_daemons">Reference installation guide</a>.</p>
<blockquote>
<p>Daemons in Rucio are background processes that perform various maintenance and operational tasks. They ensure that the system operates smoothly and that data management policies are enforced continuously.</p>
</blockquote>
<p>The description of the various daemons can be found in <a href="https://rucio.github.io/documentation/bin/rucio-abacus-account" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fts-renewal-and-delegation">FTS renewal and delegation<a href="#fts-renewal-and-delegation" class="hash-link" aria-label="Direct link to FTS renewal and delegation" title="Direct link to FTS renewal and delegation">​</a></h3>
<blockquote>
<p><a href="https://cs3mesh4eosc.eu/technologies/file-transfer-service-fts" target="_blank" rel="noopener noreferrer">FTS</a> is an open source software for reliable and large-scale data transfers. It provides easy user interfaces for submitting transfers: Python CLI, Python Client, WebFTS and Web Monitoring. Checksums and retries are provided per transfer and it is a flexible tool due to its multiprotocol support (Webdav/https, GridFTP, xroot, SRM). It also allows parallel transfers optimization to get the most from network without burning the storages.</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-fts-work-users-x509-certs">How does FTS work: users&#x27; x509 certs<a href="#how-does-fts-work-users-x509-certs" class="hash-link" aria-label="Direct link to How does FTS work: users&#x27; x509 certs" title="Direct link to How does FTS work: users&#x27; x509 certs">​</a></h4>
<ol>
<li>Users will have to pass their own x509 cert by setting its path in their rucio config.</li>
<li>Then, the x509 is used to map the cert to an identity that must be created within rucio, which corresponds to a user.</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-fts-work-service-x509-cert">How does FTS work: service x509 cert<a href="#how-does-fts-work-service-x509-cert" class="hash-link" aria-label="Direct link to How does FTS work: service x509 cert" title="Direct link to How does FTS work: service x509 cert">​</a></h4>
<p>It is not the user&#x27;s account that uploads, downloads, etc, but it&#x27;s a <em><strong>service account</strong></em> that is set up normally by the collaboration or the team.</p>
<p>Together with the service account, we also need the corresponding user <u>grid cert</u> that is split in <code>cert</code> and <code>key</code> and is passed to the <code>ftsRenewal</code> daemon, that renews it periodically through a <a href="https://github.com/rucio/containers/blob/master/fts-cron/renew_fts_proxy.sh.j2" target="_blank" rel="noopener noreferrer">specific script</a>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> fts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /opt/rucio/certs/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> fts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /opt/rucio/keys/</span><br></span></code></pre></div></div>
<p>In the Compass example, the service account grid certificate is named <code>na58dst1.p12</code>. To retrieve the <code>cert.pem</code> and <code>key.pem</code>, one can run the <a href="https://stackoverflow.com/questions/15144046/converting-pkcs12-certificate-into-pem-using-openssl" target="_blank" rel="noopener noreferrer">following these commands</a>:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl pkcs12 -in na58dst1.p12 -out na58dst1.usercert.pem -clcerts -nokeys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">openssl pkcs12 -in na58dst1.p12 -out na58dst1.userkey.pem -nocerts -nodes</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-connect-to-the-proper-vo">How to connect to the proper VO?<a href="#how-to-connect-to-the-proper-vo" class="hash-link" aria-label="Direct link to How to connect to the proper VO?" title="Direct link to How to connect to the proper VO?">​</a></h4>
<p><a href="/documentation/operator/multi_vo_rucio">Reference documentation</a>.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>VO vs VOMS</div><div class="admonitionContent_BuS1"><p>The VOMS (Virtual Organization Membership Service) is an attribute authority which serves as central repository for VO (Virtual Organization) user authorization information</p></div></div>
<ol>
<li>Specify which VO to use; in our case is <code>vo.compass.cern.ch</code></li>
<li>If not present, create a config file for the VOMS in <code>/etc/vomses</code>.
In our case, looking at lxplus we have a file named <code>vo.compass.cern.ch-voms-compass-auth.cern.ch</code> that contains</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;vo.compass.cern.ch&quot; &quot;voms-compass-auth.cern.ch&quot; &quot;443&quot; &quot;/DC=ch/DC=cern/OU=computers/CN=compass-auth.cern.ch&quot; &quot;vo.compass.cern.ch&quot; &quot;24&quot;</span><br></span></code></pre></div></div>
<p>So we need to create a secret with the proper content and <em><strong>mount</strong></em> it in the <code>ftsRenewal</code> daemon, under <code>/etc/vomses</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> voms</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">compass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /etc/vomses/</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Very important information about <code>ca-bundles</code></div><div class="admonitionContent_BuS1"><p>An additional secret is needed, and it&#x27;s the <code>rucio-ca-bundle</code> secret.
It can be obtained by copying the content of <code>/etc/grid-security/certificates</code> on LXPLUS matching the regex <code>*.0</code> and <code>*.signing_policy</code> into a single folder that will be used as a secret.</p><p>An example can be found at <a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/1897a2252e98ca3f6ea54047b1a662f57d55f774/scripts/rucio-daemons-secret.sh#L36-37" target="_blank" rel="noopener noreferrer">this link</a>.</p></div></div>
<p>In this way, we&#x27;ll get something like the following output from the cron-job:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: =================== Delegating ========================    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy:  Proxy certificate file : /tmp/x509up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy:  User certificate file: /tmp/cert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy:  User key file: /tmp/key.pem         </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Output to /tmp/x509up  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Enter GRID pass phrase:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Your identity: /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=na58dst1/CN=698253/CN=Robot: compass production </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Using configuration file /root/.glite/vomses       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Using configuration file /etc/vomses </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: .........+++           </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: ....................+++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Creating temporary proxy to /tmp/tmp_x509up_u0_317  Done </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Contacting  voms-compass-auth.cern.ch:443 [/DC=ch/DC=cern/OU=computers/CN=compass-auth.cern.ch] &quot;vo.compass.cern.ch&quot; Done   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Warning: WARNING: vo.compass.cern.ch : The validity period of the issued attributes has been shortened to the maximum allowed by this VOMS server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Creating proxy to /tmp/x509up        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: No policy language specified, Gsi impersonation proxy assumed. Done            </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Your proxy is valid until Fri May 31 15:49:15 2024 </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Error: verification failed.          </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: User certificate: /tmp/x509up        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: User private key: /tmp/x509up        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Loaded DC=ch, DC=cern, OU=Organic Units, OU=Users, CN=na58dst1, CN=698253, CN=Robot: compass production, CN=2643790443   </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Loaded DC=ch, DC=cern, OU=Organic Units, OU=Users, CN=na58dst1, CN=698253, CN=Robot: compass production    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Using endpoint: https://fts3-pilot.cern.ch:8446    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: REST API version: 3.13.0             </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Delegation ID: ef1e8a8e094bde07      </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: No previous delegation found         </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Delegating             </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Signing request        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Delegation id: ef1e8a8e094bde07      </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">renew-fts-proxy: Termination time: 2024-05-31T15:49:15 </span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods-1">Add the certificates as secrets and mount them on the k8s pods<a href="#add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods-1" class="hash-link" aria-label="Direct link to Add the certificates as secrets and mount them on the k8s pods" title="Direct link to Add the certificates as secrets and mount them on the k8s pods">​</a></h3>
<p>Now it is possible to run something similar to the <a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/1897a2252e98ca3f6ea54047b1a662f57d55f774/scripts/rucio-daemons-secret.sh" target="_blank" rel="noopener noreferrer">daemons script</a> to add all the secrets to the cluster.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-environment-variables">Additional environment variables<a href="#additional-environment-variables" class="hash-link" aria-label="Direct link to Additional environment variables" title="Direct link to Additional environment variables">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">additionalEnvs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> USERCERT_NAME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> na58dst1.usercert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> USERKEY_NAME</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> na58dst1.userkey.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RUCIO_FTS_SECRETS</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">daemons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">x509up</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> GRID_PASSPHRASE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">valueFrom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">secretKeyRef</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">daemons</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">fts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">passphrase</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> passphrase</span><br></span></code></pre></div></div>
<p>Please notice that <code>USERCERT_NAME</code> and <code>USERKEY_NAME</code> correspond to the name of <code>cert.pem</code> and <code>key.pem</code> extracted before, <code>RUCIO_FTS_SECRETS</code> doesn&#x27;t need to be changed, and <code>GRID_PASSPHRASE</code> corresponds to the passphrase chosen for the service account (can be an empty string).</p>
<p>A diagram of how the proxy certificate is created and mounted on the daemons is displayed below:</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-ui">Rucio UI<a href="#rucio-ui" class="hash-link" aria-label="Direct link to Rucio UI" title="Direct link to Rucio UI">​</a></h2>
<p><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/blob/master/sync/rucio-ui.yaml?ref_type=heads" target="_blank" rel="noopener noreferrer">Reference Helm Chart</a>.</p>
<blockquote>
<p>The Rucio User Interface (UI) provides an accessible way for users to interact with the Rucio system. It allows users to manage data, set replication rules, and monitor data transfers and storage through a graphical or command-line interface.</p>
</blockquote>
<p>As for Servers and Authentication, it is necessary to get the following components running:</p>
<ul>
<li>Dedicated LB: in the example, the domain associated with it is <code>compass-rucio-ui.cern.ch</code>
<ul>
<li>This value will be used in the <code>httpd</code> block:</li>
</ul>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">rucio_hostname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;compass-rucio-ui.cern.ch&quot;</span><br></span></code></pre></div></div>
</li>
<li>Grid Host certificates for the domain.</li>
</ul>
<p>The secrets are then mounted in the following block:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">secretMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hostcert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /etc/grid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">security/hostcert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hostcert.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hostkey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /etc/grid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">security/hostkey.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hostkey.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cafile</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> /etc/grid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">security/ca.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">subPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ca.pem</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proxy-block">Proxy block<a href="#proxy-block" class="hash-link" aria-label="Direct link to Proxy block" title="Direct link to Proxy block">​</a></h3>
<p>These settings configure how the Rucio UI will connect to the main Rucio service and the authentication service through specified proxies.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">proxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rucioProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;compass-rucio.cern.ch&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rucioAuthProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;compass-rucio-auth.cern.ch&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">rucioAuthProxyScheme</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;https&quot;</span><br></span></code></pre></div></div>
<h1>Setting up Rucio</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-rucio-clients">Installing <code>rucio-clients</code><a href="#installing-rucio-clients" class="hash-link" aria-label="Direct link to installing-rucio-clients" title="Direct link to installing-rucio-clients">​</a></h2>
<p>Please refer to the <a href="/documentation/user/setting_up_the_rucio_client">installation page</a>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>TL;DR</div><div class="admonitionContent_BuS1"><p><code>pip install rucio-clients</code></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-gfal">Installing <code>gfal</code><a href="#installing-gfal" class="hash-link" aria-label="Direct link to installing-gfal" title="Direct link to installing-gfal">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Remember to install dependencies</div><div class="admonitionContent_BuS1"><p>Install <code>gfal2</code> &quot;properly&quot;:
<a href="https://dmc-docs.web.cern.ch/dmc-docs/gfal2-python/pip-install.html" target="_blank" rel="noopener noreferrer">https://dmc-docs.web.cern.ch/dmc-docs/gfal2-python/pip-install.html</a>
AND install these plugins:</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo dnf install gfal2-plugin-srm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo dnf install gfal2-plugin-xrootd</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo dnf install gfal2-plugin-mock</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo dnf install gfal2-plugin-file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sudo dnf install gfal2-plugin-http</span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-the-rucio-root-account-configuration-file">Creating the Rucio root account configuration file<a href="#creating-the-rucio-root-account-configuration-file" class="hash-link" aria-label="Direct link to Creating the Rucio root account configuration file" title="Direct link to Creating the Rucio root account configuration file">​</a></h2>
<p>This is the minimal setup for the configuration file (<code>rucio.cfg</code>):</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">client</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio_host = https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//compass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">rucio.cern.ch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth_host = https</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//compass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">auth.cern.ch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ca_cert = /etc/pki/tls/certs/CERN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">bundle.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">auth_type = userpass</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">account = root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">username = admin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">password = xxx</span><br></span></code></pre></div></div>
<p>Where <code>username</code> and <code>password</code> are the ones created while bootstrapping the db.</p>
<p>To export the created configuration, execute:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">export RUCIO_CONFIG=&lt;path-to&gt;/rucio.cfg</span><br></span></code></pre></div></div>
<p>Then test it via <code>rucio whoami</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="optional-creating-a-rucio-client-user-pod-in-the-cluster">Optional: creating a rucio client user pod in the cluster<a href="#optional-creating-a-rucio-client-user-pod-in-the-cluster" class="hash-link" aria-label="Direct link to Optional: creating a rucio client user pod in the cluster" title="Direct link to Optional: creating a rucio client user pod in the cluster">​</a></h3>
<p>Look at the following commits to have an example of how to create a pod in the cluster that serves as u rucio user:</p>
<ul>
<li><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/commit/7579ea6fee12609a419639d3a6390cf1f9f9ee63" target="_blank" rel="noopener noreferrer">Creating a rucio client root account</a></li>
<li><a href="https://gitlab.cern.ch/rucio-it/flux-compass/-/commit/7e3075f1161c5728ca7e7d485242e152975f8b7c" target="_blank" rel="noopener noreferrer">Creating secrets</a>
<ul>
<li>Creating secrets for username, password, and cert bundle (that HAS to be the <code>CERN-bundle.pem</code> that we find in ``/etc/pki/tls/certs/CERN-bundle.pem`)</li>
</ul>
</li>
</ul>
<blockquote>
<p>[!tip] How to I pass a cert to a pod?
Create a secret for the cert, and then mount the secret to a specific path, using <code>volumeMounts</code>: take a look below</p>
</blockquote>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cern</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">bundle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">secret</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">secretName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">account</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">cern</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">bundle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">client</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> rucio/rucio</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">clients</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">34.0.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> cern</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">bundle</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/etc/pki/tls/certs/CERN-bundle.pem&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">subPath</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> CERN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">bundle.pem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">readOnly</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rucio-admin-usage">Rucio admin usage<a href="#rucio-admin-usage" class="hash-link" aria-label="Direct link to Rucio admin usage" title="Direct link to Rucio admin usage">​</a></h2>
<p>The <a href="https://rucio.github.io/documentation/bin/rucio-admin" target="_blank" rel="noopener noreferrer"><code>rucio-admin</code></a> command can be used to setup the Rucio instance.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-the-rucio-storage-elements-rses">Create the Rucio Storage Elements (RSEs)<a href="#create-the-rucio-storage-elements-rses" class="hash-link" aria-label="Direct link to Create the Rucio Storage Elements (RSEs)" title="Direct link to Create the Rucio Storage Elements (RSEs)">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse add --rse XRD1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse add --rse XRD2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse add --rse XRD3</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-protocol-definitions-for-the-storage-servers">Add the protocol definitions for the storage servers<a href="#add-the-protocol-definitions-for-the-storage-servers" class="hash-link" aria-label="Direct link to Add the protocol definitions for the storage servers" title="Direct link to Add the protocol definitions for the storage servers">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse protocol add --host xrd1 --rse XRD1 --scheme root --prefix //rucio --port 1094 --impl rucio.rse.protocols.gfal.Default --domain-json &#x27;{&quot;wan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1, &quot;third_party_copy_read&quot;: 1, &quot;third_party_copy_write&quot;: 1}, &quot;lan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1}}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse protocol add --host xrd2 --rse XRD2 --scheme root --prefix //rucio --port 1094 --impl rucio.rse.protocols.gfal.Default --domain-json &#x27;{&quot;wan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1, &quot;third_party_copy_read&quot;: 1, &quot;third_party_copy_write&quot;: 1}, &quot;lan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1}}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse protocol add --host xrd3 --rse XRD3 --scheme root --prefix //rucio --port 1094 --impl rucio.rse.protocols.gfal.Default --domain-json &#x27;{&quot;wan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1, &quot;third_party_copy_read&quot;: 1, &quot;third_party_copy_write&quot;: 1}, &quot;lan&quot;: {&quot;read&quot;: 1, &quot;write&quot;: 1, &quot;delete&quot;: 1}}&#x27;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-fts">Enable FTS<a href="#enable-fts" class="hash-link" aria-label="Direct link to Enable FTS" title="Direct link to Enable FTS">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse attribute add --rse XRD1 --key fts --value https://fts:8446</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse attribute add --rse XRD2 --key fts --value https://fts:8446</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse attribute add --rse XRD3 --key fts --value https://fts:8446</span><br></span></code></pre></div></div>
<p>Note that <code>8446</code> is the port exposed by the <code>fts-server</code> pod. You can easily view ports opened by a pod by <code>kubectl describe pod PODNAME</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fake-a-full-mesh-network">Fake a full mesh network<a href="#fake-a-full-mesh-network" class="hash-link" aria-label="Direct link to Fake a full mesh network" title="Direct link to Fake a full mesh network">​</a></h3>
<p>This command will set the distance between RSEs to 1, in order to make transfers possible.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD1 --destination XRD2 --distance 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD1 --destination XRD3 --distance 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD2 --destination XRD1 --distance 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD2 --destination XRD3 --distance 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD3 --destination XRD1 --distance 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rse distance add --source XRD3 --destination XRD2 --distance 1</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="set-indefinite-storage-quota-for-root">Set indefinite storage quota for root<a href="#set-indefinite-storage-quota-for-root" class="hash-link" aria-label="Direct link to Set indefinite storage quota for root" title="Direct link to Set indefinite storage quota for root">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio account limit add --account root --rses XRD1 --bytes infinity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio account limit add --account root --rses XRD2 --bytes infinity</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio account limit add --account root --rses XRD3 --bytes infinity</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-default-scope-for-testing">Create a default scope for testing<a href="#create-a-default-scope-for-testing" class="hash-link" aria-label="Direct link to Create a default scope for testing" title="Direct link to Create a default scope for testing">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio scope add --account root --scope test</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-management">Data management<a href="#data-management" class="hash-link" aria-label="Direct link to Data management" title="Direct link to Data management">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-initial-transfer-testing-data">Create initial transfer testing data<a href="#create-initial-transfer-testing-data" class="hash-link" aria-label="Direct link to Create initial transfer testing data" title="Direct link to Create initial transfer testing data">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dd if=/dev/urandom of=file1 bs=10M count=1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dd if=/dev/urandom of=file2 bs=10M count=1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dd if=/dev/urandom of=file3 bs=10M count=1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dd if=/dev/urandom of=file4 bs=10M count=1</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload-the-files">Upload the files<a href="#upload-the-files" class="hash-link" aria-label="Direct link to Upload the files" title="Direct link to Upload the files">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio upload --rse XRD1 --scope test --files file1 file2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio upload --rse XRD2 --scope test --files file3 file4</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-few-datasets-and-containers">Create a few datasets and containers<a href="#create-a-few-datasets-and-containers" class="hash-link" aria-label="Direct link to Create a few datasets and containers" title="Direct link to Create a few datasets and containers">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did add --type dataset --did test:dataset1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did content add --to test:dataset1 --did test:file1 test:file2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did add --type dataset --did test:dataset2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did content add --to test:dataset2 --did test:file3 test:file4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did add --type container --did test:container</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did content add --to test:container --did test:dataset1 test:dataset2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did add --type dataset --did test:dataset3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did content add --to test:dataset3 --did test:file4</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-rule-and-remember-returned-rule-id">Create a rule and remember returned rule ID<a href="#create-a-rule-and-remember-returned-rule-id" class="hash-link" aria-label="Direct link to Create a rule and remember returned rule ID" title="Direct link to Create a rule and remember returned rule ID">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rule add --did test:container --rses XRD3 --copies 1</span><br></span></code></pre></div></div>
<p>This command will output a rule ID, which can also be obtained via:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rule list --did test:container</span><br></span></code></pre></div></div>
<p>Query the status of the rule until it is completed. Note that the daemons are running with long sleep cycles (e.g. 30 seconds, 60 seconds) by default, so this will take a bit. You can always watch the output of the daemon containers to see what they are doing.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio rule show --rule-id &lt;rule_id&gt;</span><br></span></code></pre></div></div>
<p>Add some more complications</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio did add --type dataset -d test:dataset3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rucio attach test:dataset3 test:file4</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/rucio/documentation/tree/main/docs/../docs/operator/k8s_guide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-10-08T13:38:43.000Z" itemprop="dateModified">Oct 8, 2025</time></b> by <b>dependabot[bot]</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/operator/did_meta"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">DID Metadata</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/operator/monitoring"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Monitoring</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-the-rucio-cluster-on-openstack" class="table-of-contents__link toc-highlight">Creating the Rucio cluster on Openstack</a></li><li><a href="#create-the-database-with-dbod" class="table-of-contents__link toc-highlight">Create the database with DBOD</a><ul><li><a href="#bootstrapping-the-database" class="table-of-contents__link toc-highlight">Bootstrapping the database</a></li></ul></li><li><a href="#creating-a-landb-set" class="table-of-contents__link toc-highlight">Creating a LanDB set</a></li><li><a href="#managing-secrets" class="table-of-contents__link toc-highlight">Managing secrets</a><ul><li><a href="#sealed-secrets" class="table-of-contents__link toc-highlight">Sealed-Secrets</a></li><li><a href="#creating-secrets-for-the-cluster" class="table-of-contents__link toc-highlight">Creating secrets for the cluster</a></li></ul></li><li><a href="#rucio-servers" class="table-of-contents__link toc-highlight">Rucio Servers</a><ul><li><a href="#produce-the-helm-chart" class="table-of-contents__link toc-highlight">Produce the Helm chart</a></li><li><a href="#create-the-db-secret" class="table-of-contents__link toc-highlight">Create the DB secret</a></li><li><a href="#setup-the-lb" class="table-of-contents__link toc-highlight">Setup the LB</a></li><li><a href="#produce-the-certificates-related-to-the-landb-alias" class="table-of-contents__link toc-highlight">Produce the certificates related to the landb-alias</a></li><li><a href="#add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods" class="table-of-contents__link toc-highlight">Add the certificates as secrets and mount them on the k8s pods</a></li></ul></li><li><a href="#rucio-auth" class="table-of-contents__link toc-highlight">Rucio Auth</a></li><li><a href="#rucio-daemons" class="table-of-contents__link toc-highlight">Rucio Daemons</a><ul><li><a href="#fts-renewal-and-delegation" class="table-of-contents__link toc-highlight">FTS renewal and delegation</a></li><li><a href="#add-the-certificates-as-secrets-and-mount-them-on-the-k8s-pods-1" class="table-of-contents__link toc-highlight">Add the certificates as secrets and mount them on the k8s pods</a></li><li><a href="#additional-environment-variables" class="table-of-contents__link toc-highlight">Additional environment variables</a></li></ul></li><li><a href="#rucio-ui" class="table-of-contents__link toc-highlight">Rucio UI</a><ul><li><a href="#proxy-block" class="table-of-contents__link toc-highlight">Proxy block</a></li></ul></li><li><a href="#installing-rucio-clients" class="table-of-contents__link toc-highlight">Installing <code>rucio-clients</code></a><ul><li><a href="#installing-gfal" class="table-of-contents__link toc-highlight">Installing <code>gfal</code></a></li></ul></li><li><a href="#creating-the-rucio-root-account-configuration-file" class="table-of-contents__link toc-highlight">Creating the Rucio root account configuration file</a><ul><li><a href="#optional-creating-a-rucio-client-user-pod-in-the-cluster" class="table-of-contents__link toc-highlight">Optional: creating a rucio client user pod in the cluster</a></li></ul></li><li><a href="#rucio-admin-usage" class="table-of-contents__link toc-highlight">Rucio admin usage</a><ul><li><a href="#create-the-rucio-storage-elements-rses" class="table-of-contents__link toc-highlight">Create the Rucio Storage Elements (RSEs)</a></li><li><a href="#add-the-protocol-definitions-for-the-storage-servers" class="table-of-contents__link toc-highlight">Add the protocol definitions for the storage servers</a></li><li><a href="#enable-fts" class="table-of-contents__link toc-highlight">Enable FTS</a></li><li><a href="#fake-a-full-mesh-network" class="table-of-contents__link toc-highlight">Fake a full mesh network</a></li><li><a href="#set-indefinite-storage-quota-for-root" class="table-of-contents__link toc-highlight">Set indefinite storage quota for root</a></li><li><a href="#create-a-default-scope-for-testing" class="table-of-contents__link toc-highlight">Create a default scope for testing</a></li></ul></li><li><a href="#data-management" class="table-of-contents__link toc-highlight">Data management</a><ul><li><a href="#create-initial-transfer-testing-data" class="table-of-contents__link toc-highlight">Create initial transfer testing data</a></li><li><a href="#upload-the-files" class="table-of-contents__link toc-highlight">Upload the files</a></li><li><a href="#create-a-few-datasets-and-containers" class="table-of-contents__link toc-highlight">Create a few datasets and containers</a></li><li><a href="#create-a-rule-and-remember-returned-rule-id" class="table-of-contents__link toc-highlight">Create a rule and remember returned rule ID</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/documentation/img/rucio_horizontaled_black.svg" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/rucio_horizontaled_white.svg" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU"></div><div class="footer__copyright">Copyright © 2023 CERN</div></div></div></footer></div>
</body>
</html>